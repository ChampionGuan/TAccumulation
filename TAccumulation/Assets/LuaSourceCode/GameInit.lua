---优先初始化宏定义，避免lua和app的宏不一致问题
if not UNITY_EDITOR then require("Config.System.AutoGenerated.ScriptingDefineForBuild",true,true) end
Debug.LogFormat("AppVer=[%s],ResVer=[%s],BuildNum=[%s]",CS.X3Game.AppInfoMgr.Instance.AppInfo.AppVer,CS.X3Game.AppInfoMgr.Instance.AppInfo.ResVer,CS.X3Game.AppInfoMgr.Instance.AppInfo.BuildNum)
---本类主要是初始化公共非业务项的基础接口
--region framework 初始化
require("LuaEnvInit")
require("PureLogic.Init")
require("PureLogic.ClientInit")
require("GlobalConstInit")

--endregion

---DelegateHandler
local delegateHandler = require("Runtime.System.X3Game.Modules.GameMisc.DelegateHandler")
delegateHandler.OnInit()

--region ABUnload(false)下load, 保证不会被误清理
Res.SetABUnloadParameter(false)
Res.SetFileLoaderMaxReleaseCount(1000000)
--endregion

--region 游戏基础控件初始化, 必须保序
GameMgr.InitGlobal("GameInit")
--endregion

---ServerUrl
ServerUrl = ServerUrl.new()
ServerUrl:Init()
---GameHttpRequest
GameHttpRequest = GameHttpRequest.new()
---TbUtil
TbUtil = CS.X3Battle.TbUtil

---编辑器下开启Profiler检查
if UNITY_EDITOR then
    Profiler.SetDebugEnable(true)
end

---接入CrashSight数据上报
local region = tostring(Locale.GetRegion())
CrashSightMgr.SetRegion(region)


--在游戏重启的时候, 会重新调用此方法
function InitSystem()

    ---配置表合表
    LuaCfgMgr.ParseMerger()
    --region 基础通用组件初始化
    ---注册通用获取文本方法
    GameObjectCtrl.AddHandler("GetUIText", UITextHelper.GetUIText)
    GameObjectCtrl.AddHandler("GetTextId", UITextHelper.GetTextId)

    ---开启全局点击
    GameHelper.SetGlobalTouchEnable(true)
    --endregion

    --region UIMgr
    UIMgr.AddViewToggle({ UIConf.BuyPowerWnd })
    UIMgr.SetWarningCloseConf({ [UIConf.MessageBox] = true, [UIConf.TipsWnd] = true, [UIConf.LoadingWnd] = true, [UIConf.IndicatorWnd] = true })
    UIMgr.SetCloseNoGCWhiteList({ [UIConf.MessageBox] = true, [UIConf.TipsWnd] = true, [UIConf.Message2Box] = true, [UIConf.IndicatorWnd] = true })
    UITextHelper.InitReplaceTag(true)
    --endregion

    local GameInitializer = require("Runtime.System.X3Game.Modules.Common.GameInitializer")
    GameInitializer.Init()

    ---GM
    local gmEnable = GameHelper.CheckDebugMode(GameConst.DebugMode.GM_MODE)
    if gmEnable then
        CS.X3Game.GMCommandManager.Init()
    end
end

InitSystem()


