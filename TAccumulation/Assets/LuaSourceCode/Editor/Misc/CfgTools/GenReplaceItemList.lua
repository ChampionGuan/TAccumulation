---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by doudou.
--- DateTime: 2023/4/27 14:21
---@class GenReplaceItemList:BaseCfgHandler
local GenReplaceItemList = class("GenItemSourceList", BaseCfgHandler)

---入口
function GenReplaceItemList:Execute()
    local file_path = LUA_CFG_PATH .. "ReplaceItemList.lua"
    local item_source_list = self:GetReplaceItemList()
    self:WriteFile(file_path, item_source_list)
end

function GenReplaceItemList:GetReplaceItemList()
    local map_list = {}
    local item_cfg = LuaCfgMgr.GetAll("Item")
    for k, v in pairs(item_cfg) do
        ---@type S2Int
        local replaceItem = v.ReplaceItem
        local replacedId = replaceItem and replaceItem.Num or 0
        if replacedId ~= 0 then
            local replacedItemCfg = LuaCfgMgr.Get("Item", replacedId)
            if replacedItemCfg == nil then
                Debug.LogErrorFormat("Invalid replaced item id:{0} for item:{1}", replacedId, v.ID)
            elseif replacedItemCfg.Type ~= replaceItem.ID then
                Debug.LogErrorFormat("Invalid replaced item type:{0} for item:{1}", replaceItem.ID, replaceItem.Num)
            else
                if map_list[replaceItem.Num] == nil then
                    map_list[replaceItem.Num] = {}
                end
                table.insert(map_list[replaceItem.Num], v.ID)
            end
        end
    end

    return map_list
end


return GenReplaceItemList