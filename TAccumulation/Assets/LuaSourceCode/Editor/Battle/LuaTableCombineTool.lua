---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by admin.
--- DateTime: 2021/1/15 10:23
---

local ConfigPostProcess = require("Editor.Battle.ConfigPostProcess")
local ConfigCheck = require("Editor.Battle.ConfigCheck")
local ConfigCheckShape = require("Editor.Battle.ConfigCheckShape")

---@type table<Int, SkillConfig>
local SkillConfigs = LuaCfgMgr.GetAll("Battle.Config.SkillConfig")

---@class SkillLevelConfig
---@field Desc string
---@field Level number
---@field CD number
---@field Damage Fix
---@field FsmFilename string 状态机配置文件名，覆盖
---@field EventTimelineID string 时间线ID
---@field BuffIDs Int[] buff列表，技能创建是触发，主要用于被动技能，但主动技能也可以用
---@field BuffLevels Int[]
---@field BuffMountTypes Int[]
---@field DamageIDs Int[]
---
---@type table<Int, SkillLevelConfig[]>
local SkillLevelConfigs = LuaCfgMgr.GetAll("Battle.Config.SkillLevelConfig")

---@class SkillPassiveConfig
---@field SkillID Int
---@field Level Int
---@field Name string
---@field SkillIcon string
---@field Desc string
---@field AddBuff Int[]
---@field AddBuffLevel Int[]
---@field SkillType Int 技能类型
---
---@type table<Int, SkillPassiveConfig[]>
local SkillPassiveConfigs = LuaCfgMgr.GetAll("Battle.Config.SkillPassiveConfig")

---@class FemaleActorConfig
---@field FemaleBattleFashionID number
---@field Type ActorType
---@field Name string
---@field IconName string
---@field ModelID Int
---@field EditorVisible Int 是否编辑器可见
---@field AnimatorFilename string Animator（动画控制器）文件名
---@field RMClipFilename string RootMotion Clip文件名
---@field TimelineEvent string Timeline配置文件名称
---@field DisableRootMotion Int 是否禁用RootMotion
---@field RigidPoint Fix 霸体值
---@field BattleAIName string 战斗AI树名称
---@field BattleAITriggerIDs Int[] 战斗AI树TriggerIDs
---@field TalkAITriggerIDs Int[] 沟通AI树TriggerIDs

---@type table<Int, FemaleActorConfig>
local FemaleActorConfig = LuaCfgMgr.GetAll("Battle.Config.FemaleActorConfig")

---@type table<Int, MaleActorConfig>
local MaleActorConfig = LuaCfgMgr.GetAll("Battle.Config.MaleActorConfig")

---@class ModelConfig
---@field ModelID Int
---@field PrefabName string
---@field Weight Int 重量
---@field Shape Int 形状 1. 圆 2. 横向胶囊 3. 纵向胶囊
---@field Radius Fix 半径
---@field Length Fix 形状为胶囊时有效
---@field DummyCamMargin Int[] 摄像机看向点容差裕度
---@field DummiesID Int
---@field HurtShakeName string 受击抖动资源名称
---@field DisableHurtScar boolean 是否禁用受击砍痕
---@field FootEffect string[] 怪物脚底特效
---@field FashionID Int 时装ID
---@field TurnAccelerationAngle Fix 转身加速度角度
---@field TurnAccelerationTime Fix 转身加速度时间（从0到最大转身速度MaxTurnSpeed）
---@field MaxTurnSpeed Fix 最大转身加速度
---@field FxRadius Fix 特效半径
---@field FxHeight Fix 高度

---@type table<Int, ModelConfig>
local ModelConfig = LuaCfgMgr.GetAll("Battle.Config.ModelConfig")

---@type table<Int, ActorConfig>
---local ActorConfigs = LuaCfgMgr.GetAll("Battle.Config.ActorSCoreConfig")


---@type table<Int, ActorSlotFSMConfig>
---local ActorSlotFSMConfigs = LuaCfgMgr.GetAll("Battle.Config.ActorSlotFSMConfig")

---@class MonsterTemplateConfig
---@field ID Int
---@field Name string
---@field CommonName string
---@field PrefabName string
---@field AIFilename string
---@field AttackIDs Int[]
---@field ActiveSkillIDs Int[]
---@field DeadSkillIDs Int[]
---@field Radius Fix
---@field Weight Int
---@field Shape Int
---@field Length Fix
---@field BornDuration Fix
---@field BornTimeline string 出生Timeline
---@field BornEventTimeline string 出生Timeline
---@field BornTime Fix 出生Timeline时长
---@field TurnAccelerationAngle Fix 转身加速度角度
---@field TurnAccelerationTime Fix 转身加速度时间（从0到最大转身速度MaxTurnSpeed）
---@field MaxTurnSpeed Fix 最大转身加速度
---@field DeadFreezeTime Fix
---@field DeadEffect Int
---@field DeadFXTime Fix
---@field BattleAIName string
---@field IconName string
---@field TimelineEvent string Timeline配置文件名称
---@field HitShakeName string
---@field DisableHitScar boolean
---@field DisableRootMotion Int
---@field AnimatorFilename string
---@field RMClipFilename string
---@field DynamicCastSlots table
---@field FxRadius Fix 特效半径
---@field FxHeight Fix 高度
---@field WeakRecoverTime Fix 虚弱恢复动画时间
---@field CloseUpName string 怪物出场名字图片路径
---@field CloseUpBubble string 怪物出场描述
---@field DisableWeakUI boolean 是否禁用虚弱UI
---@field TalkAIMaleName string 怪物对应的男主TalkAI
---@field TalkAIFemaleName string 怪物对应的女主TalkAI
---@field TalkAITriggerIDs Int[] 沟通AI树TriggerIDs
---@field SummonMonsterIDs Int[] 新增召唤物配置 @新增
---@field Type Int @Monster表移入
---@field EditorVisible Int @Monster表移入
---@field HPVisible Int @Monster表移入

---@type table<Int, MonsterTemplateConfig>
local monsterTemplateConfigs = LuaCfgMgr.GetAll("Battle.Config.MonsterTemplate")
---@class MonsterConfig ---待删
---@field ID Int
---@field Name string
---@field TemplateID Int
---@field Type Int
---@field RigidPoint Fix
---@field BattleAIName string
---@field ShieldInit Fix
---@field ShieldMax Fix
---@field ShieldRecoverTime Fix
---@field EditorVisible Int
---@field HPVisible Int
---
---@type table<Int, MonsterConfig>
---local monsterConfigs = LuaCfgMgr.GetAll("Battle.Config.Monster")


---@class MonsterSummonConfig
---@field ID Int
---@field Name string
---@field MonsterTemplateID Int
---@field MonsterID Int 待刪
---@field LifeTime Fix
---@field Source Int 待刪
---@field HPScale Fix 待刪
---@field PhyAttackScale Fix 待刪
---@field PhyDefenceScale Fix 待刪
---@field CritValScale Fix 待刪
---@field ElementScale Fix 待刪
---@field DeadWithMaster Int
---@field EnableBeLocked Int
---@field MaxNum Int
---@field ShowUI boolean
---
---@type table<Int, MonsterSummonConfig>
local monsterSummonConfigs = LuaCfgMgr.GetAll("Battle.Config.MonsterSummon")

---@class BattleLevelEXLConfig
---@field ID Int
---@field Name string
---@field SceneName string
---@field WwiseIDs Int[]
---@field BackgroundMusic string
---@field LogicFilename string
---@field TimeLimit Fix
---@field TimeLimitType Int
---@field PropertyIDs Int[]
---@field PlayerIndex Int
---@field WomanID Int
---@field WomanFactionType Int
---@field WomanPosition FVector3
---@field WomanForward FVector3
---@field ManID Int
---@field ManFactionType Int
---@field ManPosition FVector3
---@field ManForward FVector3
---@field MonsterID Int
---@field MonsterFactionType Int
---@field MonsterPosition FVector3
---@field MonsterForward FVector3
---@field ElementType Int 元素类型
---@field ElementRatio Fix 元素适应系数
---@field FinalDmgAddRate Fix 最终伤害增加
---@field AirWallID Int 空气墙ID
---@field CloseCut boolean
---@field StageID Int
---
---@type table<Int, BattleLevelEXLConfig>
---local BattleLevelConfigs = LuaCfgMgr.GetAll("Battle.Config.BattleLevelConfig")

---@class BattleLevelMonsterConfig
---@field ID Int
---@field LevelID Int
---@field MonsterGroup Int
---@field MonsterID Int
---@field FactionType Int
---@field Position FVector3
---@field Forward FVector3
---@field PropertyID Int
---@field BackgroundMusic string

---@type table<Int, BattleLevelMonsterConfig>
---local BattleLevelMonsterConfigs = LuaCfgMgr.GetAll("Battle.Config.BattleLevelMonsterConfig")

---
---@type table<Int, BattleLevelPropertyConfig>
---local BattleLevelPropertyConfigs = LuaCfgMgr.GetAll("Battle.Config.BattleLevelPropertyConfig")

---@type table<number,BattleLevelConfig>
local TempBattleLevelConfigs = {}

LuaTableCombineTool = {}

function LuaTableCombineTool.CombineTables()
    if not ConfigCheck.CheckCfg(LUA_BATTLE_CFG) then
        return
    end
    if not ConfigCheckShape.CheckConfigShape() then
        return
    end

    print("LuaTableCombineTool.CombineTables")
    local SkillConfig = ConfigPostProcess.SkillConfigPostProcess(SkillConfigs, SkillLevelConfigs, SkillPassiveConfigs)
    BaseCfgHandler:WriteFile(LUA_BATTLE_CFG .. 'SkillConfig.lua', SkillConfig)
    --BaseCfgHandler:Delete(LUA_BATTLE_CFG ..  'SkillLevelConfig.lua')
    BaseCfgHandler:Delete(LUA_BATTLE_CFG .. 'SkillPassiveConfig.lua')
    g_SkillConfigs = LuaCfgMgr.GetAll("Battle.Config.SkillConfig")
    ---@type table<Int, ActorConfig>
    local ActorConfigs = ConfigPostProcess.RoleConfigPostProcess(FemaleActorConfig, MaleActorConfig, ModelConfig)
    local targetActorConfigs = ConfigPostProcess.MonsterConfigPostProcess(ActorConfigs, monsterTemplateConfigs, monsterSummonConfigs)
    BaseCfgHandler:WriteFile(LUA_BATTLE_CFG .. 'ActorConfig.lua', targetActorConfigs)
    --BaseCfgHandler:Delete(LUA_BATTLE_CFG ..  'MonsterTemplate.lua')
    --BaseCfgHandler:Delete(LUA_BATTLE_CFG ..  'Monster.lua')
    BaseCfgHandler:Delete(LUA_BATTLE_CFG .. 'FemaleActorConfig.lua')
    BaseCfgHandler:Delete(LUA_BATTLE_CFG .. 'ModelConfig.lua')
    ---local targetBattleLevelConfigs = ConfigPostProcess.BattleLevelPostProcess(TempBattleLevelConfigs, BattleLevelConfigs)
    ---BaseCfgHandler:WriteFile(LUA_BATTLE_CFG .. 'BattleLevelConfig.lua', targetBattleLevelConfigs)
    ---BaseCfgHandler:Delete(LUA_BATTLE_CFG .. 'BattleLevelMonsterConfig.lua')
    ---BaseCfgHandler:Delete(LUA_BATTLE_CFG .. 'BattleLevelPropertyConfig.lua')
end

LuaTableCombineTool.CombineTables()
return LuaTableCombineTool