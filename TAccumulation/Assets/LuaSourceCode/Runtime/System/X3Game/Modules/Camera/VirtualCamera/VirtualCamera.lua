---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by chaoguan.
--- DateTime: 2021/4/15 10:56
---

local CineMachineComponentType = {
    [CameraComponentType.Donothing] = nil,
    [CameraComponentType.FramingTransposer] = CS.Cinemachine.CinemachineFramingTransposer,
    [CameraComponentType.HardLockToTarget] = CS.Cinemachine.CinemachineHardLockToTarget,
    [CameraComponentType.OrbitalTransposer] = CS.Cinemachine.CinemachineOrbitalTransposer,
    [CameraComponentType.TrackedDolly] = CS.Cinemachine.CinemachineTrackedDolly,
    [CameraComponentType.Transposer] = CS.Cinemachine.CinemachineTransposer,
    [CameraComponentType.Composer] = CS.Cinemachine.CinemachineComposer,
    [CameraComponentType.GroupComposer] = CS.Cinemachine.CinemachineGroupComposer,
    [CameraComponentType.HardLookAt] = CS.Cinemachine.CinemachineHardLookAt,
    [CameraComponentType.POV] = CS.Cinemachine.CinemachinePOV,
    [CameraComponentType.SameAsFollowTarget] = CS.Cinemachine.CinemachineSameAsFollowTarget,
}

---@class VirtualCamera:VirtualCameraBase
---@field _cineMachineComponents table<CameraComponentType, Cinemachine.CinemachineComponentBase>
local VirtualCamera = class("VirtualCamera", require("Runtime.System.X3Game.Modules.Camera.Base.VirtualCameraBase"))
VirtualCamera.CineMachineCameraType = CS.Cinemachine.CinemachineVirtualCamera

---@param modePath string
---@param prefabInsOrFullPath UnityEngine.GameObject|string|nil 预设实例、预设完整路径，或者传空
---@param priority CameraPriorityType
function VirtualCamera:ctor(modePath, prefabInsOrFullPath, priority)
    self._cineMachineComponents = {}
    self.super.ctor(self, modePath, prefabInsOrFullPath, priority)
end

---@param value number
function VirtualCamera:SetFarClipPlane(value)
    local lens = self._cineMachineVirtualCamera.m_Lens
    lens.FarClipPlane = value
    self._cineMachineVirtualCamera.m_Lens = lens
end

---@param fov number
function VirtualCamera:SetFov(fov)
    local lens = self._cineMachineVirtualCamera.m_Lens
    lens.FieldOfView = fov
    self._cineMachineVirtualCamera.m_Lens = lens
end

---@return number
function VirtualCamera:GetFov()
    return self._cineMachineVirtualCamera.m_Lens.FieldOfView
end

---@param type CameraComponentType
---@return Cinemachine.CinemachineComponentBase
function VirtualCamera:EnsureComponent(type)
    local comp = self._cineMachineComponents[type]
    if not comp then
        comp = self._cineMachineVirtualCamera:GetCinemachineComponent(typeof(CineMachineComponentType[type]))
        if not comp then
            comp = self._cineMachineVirtualCamera:AddCinemachineComponent(typeof(CineMachineComponentType[type]))
        end
        self._cineMachineComponents[type] = comp
    end
    return comp
end

---@param type CameraComponentType
function VirtualCamera:DestroyComponent(type)
    self._cineMachineVirtualCamera:DestroyCinemachineComponent(typeof(CineMachineComponentType[type]))
    self._cineMachineComponents[type] = nil
end

return VirtualCamera