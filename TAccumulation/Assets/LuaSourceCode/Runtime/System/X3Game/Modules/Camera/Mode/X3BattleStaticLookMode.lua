---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by chaoguan.
--- DateTime: 2021/6/18 16:54
---

local X3StaticCamera = CS.Cinemachine.X3StaticLookCamera

---@class X3BattleStaticLookMode:CameraModeBase
---@field virtualCamera VirtualCamera
local X3BattleStaticLookMode = class("X3BattleStaticLookMode", require("Runtime.System.X3Game.Modules.Camera.Base.CameraModeBase"))
X3BattleStaticLookMode.CameraClassType = CameraClassType.virtualCamera

---@param verticalFOV boolean
function X3BattleStaticLookMode:OnAwake(verticalFOV)
    ---增加抖动接收组件
    self.virtualCamera:AddCineMachineExtension(CameraExtensionType.ImpulseListener)
    EventMgr.AddListener(CameraEvent.SmoothTransition, self._SetSmooth, self)
    EventMgr.AddListener(CameraEvent.Active, self._SetActive, self)

    self._x3StaticCamera = GameObjectUtil.EnsureCSComponent(self.virtualCamera:GetRoot(), typeof(X3StaticCamera))
    self._x3StaticCamera.m_verticalFov = verticalFOV or false
end

function X3BattleStaticLookMode:OnDestroy()
    EventMgr.RemoveListenerByTarget(self)
end

---@param isSmooth boolean
---@param position UnityEngine.Vector3
---@param eulerAngles UnityEngine.Vector3
---@param fov number
function X3BattleStaticLookMode:SetCameraInfo(isSmooth, position, eulerAngles, fov)
    if position then
        self._x3StaticCamera.m_position = position
    end
    if eulerAngles then
        self._x3StaticCamera.m_eulerAngles = eulerAngles
    end
    if fov then
        self._x3StaticCamera.m_fov = fov
    end
    self._x3StaticCamera:SetSmooth(false)
    self:_SetSmooth(isSmooth)
end

function X3BattleStaticLookMode:_SetActive(active)
    if active then
        self.virtualCamera:SetEnable()
    else
        self.virtualCamera:SetDisable()
    end
end

---@param isSmooth boolean
function X3BattleStaticLookMode:_SetSmooth(isSmooth)
    if isSmooth then
        GlobalCameraMgr.SetDefaultBlend(CameraDefaultBlendStyle.EaseOut, 0.8)
    else
        GlobalCameraMgr.SetDefaultBlend(CameraDefaultBlendStyle.Cut, 0)
    end
end

return X3BattleStaticLookMode