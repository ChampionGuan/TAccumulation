---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by doudou.
--- DateTime: 2023/2/7 15:51
---class X3InputPostProcess
local X3InputPostProcess = class("X3InputPostProcess")

function X3InputPostProcess.Init()
    CS.PapeGames.X3UI.X3InputField.OnEndEditPostProcess = X3InputPostProcess.OnPostProcess
end

---@param inputField PapeGames.X3UI.X3InputField
function X3InputPostProcess.OnPostProcess(inputField, text, timeDelta)
    if timeDelta < inputField.EditCD then
        UICommonUtil.ShowMessage(UITextConst.UI_TEXT_5774, math.ceil(inputField.EditCD - timeDelta))
        return nil
    end

    local isOverflow, result = X3InputPostProcess.CheckOverflow(text, inputField.PostCharacterLimit)
    if not inputField.IgnoreSensitiveWord and  GameHelper.ContainSensitiveWord(result) then
        UICommonUtil.ShowMessage(UITextConst.UI_TEXT_5771)
        return nil
    end

    if not inputField.EnableAllSpace and #string.trim(result) == 0 then
        result = ""
    end

    if not inputField.EnableEmpty and string.isnilorempty(result) then
        UICommonUtil.ShowMessage(UITextConst.UI_TEXT_5773)
        return nil
    end

    if isOverflow then
        local cfg = LuaCfgMgr.Get("LocalizationLanguage", Locale.GetLang())
        if cfg and cfg.TipsIsNumOfWord == 1 then
            UICommonUtil.ShowMessage(UITextConst.UI_TEXT_5775, math.ceil(inputField.PostCharacterLimit / 2))
        else
            UICommonUtil.ShowMessage(UITextConst.UI_TEXT_5776, inputField.PostCharacterLimit)
        end
    end

    return result
end

function X3InputPostProcess.CheckOverflow(text, characterLimit)
    if characterLimit <= 0 or string.getcharaterlength(text) <= characterLimit then
        return false, text
    else
        return true, string.cutoverflow(text, characterLimit)
    end
end

return X3InputPostProcess