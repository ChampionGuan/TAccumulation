---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2020/11/17 15:39
---通用提示

local Tips = class("Tips")
local EVENT_CHANGE_TEXT = "TIPS_CHANGE_TEXT"
local CS_SHOW_TIPS = "CS_SHOW_TIPS"
local CLOSE_TIPS ="CLOSE_TIPS"
local MESSAGE_ID = 1
function Tips:Init()
    self.condition_ctrl = require("Runtime.System.X3Game.Modules.Common.MultiConditionCtrl").new()
    self.view_tag = UIConf.TipsWnd
    self:RegistEvent()
end

function Tips:OnEventSetEnable(is_enable,...)
    local id
    if is_enable then
        id = self:GetId()
    else
        id = select(1,...)
    end
    self.condition_ctrl:SetIsRunning(id,is_enable,...)
    self:CheckShow(not is_enable)
end

function Tips:CheckShow(no_check)
    local condition_running = self.condition_ctrl:IsRunning()
    if self:IsRunning() == condition_running then
        if not no_check then
            self:CheckText()
        end
        if UIMgr.IsOpened(self.view_tag) then
            return
        end
    end
    self.is_running = condition_running
    if self:IsRunning() then
        if not UIMgr.IsOpened(self.view_tag) then
            UIMgr.Open(self.view_tag,self:GetCurParam())
        else
            self:CheckText()
        end

    else
        if UIMgr.IsOpened(self.view_tag) then
            EventMgr.Dispatch(CLOSE_TIPS)
        end
    end
end

function Tips:GetCurParam()
    local running_type = self.condition_ctrl:GetRunningType()
    local param = self.condition_ctrl:GetParam()
    if param then
        return running_type,table.unpack(param)
    end
    return running_type
end

function Tips:CheckText()
    self:RefreshText(self:GetCurParam())
end

function Tips:GetId()
    MESSAGE_ID = MESSAGE_ID+1
    return MESSAGE_ID
end

function Tips:ClearId()
    MESSAGE_ID = 1
end

function Tips:RefreshText(...)
    EventMgr.Dispatch(EVENT_CHANGE_TEXT,...)
end

function Tips:IsRunning()
    return self.is_running
end

function Tips:Clear()
    self.condition_ctrl:Clear()
end

function Tips:OnSceneBeginLoad()
    self:Clear()
    self:CheckShow()
end

function Tips:OnEventCSShowTips(text_or_id)
    UICommonUtil.ShowMessage(text_or_id)
end

function Tips:RegistEvent()
    EventMgr.AddListener(Const.Event.SET_TIPS_ENABLE,self.OnEventSetEnable,self)
    EventMgr.AddListener(Const.Event.SCENE_BEGIN_LOAD, self.OnSceneBeginLoad, self)
    EventMgr.AddListener(CS_SHOW_TIPS, self.OnEventCSShowTips, self)
end
Tips:Init()
return Tips