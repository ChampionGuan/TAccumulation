---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by canghai.
--- DateTime: 2022/8/26 12:07
---

---@alias ItemSubData NormalItemData | CardIconData | CardChipData | SCoreIcon_SData
---
---@class ItemDataFactory
local ItemDataFactory = {}

local ItemDataTypeRequirePathDic = {
    [ItemConst.ItemType.NORMAL_ITEM] = ItemConst.ITEM_NORMAL_DATA_PATH,
    [ItemConst.ItemType.SCORE_ICON_S] = ItemConst.ITEM_SCORE_ICON_S_DATA_PATH,
    [ItemConst.ItemType.CARD_CHIP] = ItemConst.ITEM_CARD_CHIP_DATA_PATH,
    [ItemConst.ItemType.CARD_ICON] = ItemConst.ITEM_CARD_ICON_DATA_PATH,
    [ItemConst.ItemType.CORE_ICON] = ItemConst.ITEM_CORE_ICON_DATA_PATH,
    [ItemConst.ItemType.CARD_ICON_BIG] = ItemConst.ITEM_CARD_ICON_BIG_DATA_PATH,
}
---@type Pool
local ItemDataPool
---@type table<number, Pool>
local ItemDataPoolMap = {}

--- 从对象池中获取ItemData
---@param owner ItemCtrl 需要传入owner
function ItemDataFactory.GetItemData(owner)
    if ItemDataPool == nil then
        ItemDataPool = PoolUtil.Get(function()
            return require(ItemConst.ITEM_DATA_PATH).new()
        end, function(data)
            data:Clear()
        end)
    end
    
    ---@type Item.ItemData
    local data = ItemDataPool:Get()
    data.owner = owner;
    return data
end

function ItemDataFactory.ReleaseItemData(data)
    ItemDataPool:Release(data)
end

--- 从对象池中获取ItemSubData
---@param owner Item.ItemData 需要传入owner
---@param itemType ItemConst.ItemType
function ItemDataFactory.GetItemSubData(owner, itemType)
    ---@type Pool
    local pool = ItemDataPoolMap[itemType]
    if pool == nil then
        pool = PoolUtil.Get(function()
            return require(ItemDataTypeRequirePathDic[itemType]).new()
        end, function(subData)
            subData:Clear()
        end)
        ItemDataPoolMap[itemType] = pool
    end

    ---@type ItemSubData
    local subData = pool:Get(itemType)
    subData.owner = owner
    return subData
end

function ItemDataFactory.ReleaseItemSubData(data, itemType)
    if data ~= nil then
        ItemDataPoolMap[itemType]:Release(data)
    end
end

return ItemDataFactory