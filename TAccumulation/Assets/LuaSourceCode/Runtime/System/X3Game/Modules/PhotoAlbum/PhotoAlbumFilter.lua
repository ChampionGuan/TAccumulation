---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by kan.
--- DateTime: 2022/4/11 14:25
---
---@class PhotoAlbumFilter:UICtrl
local PhotoAlbumFilter = class("PhotoAlbumFilter",UICtrl)

function PhotoAlbumFilter:Init()
    self.IsInit = true
    self.hideSelf = false
end

---界面关闭
function PhotoAlbumFilter:OnClose()

end

---初始化查询组件
---@param roleTab TabMenu 角色页签
---@param modeDropDown X3DropDown 模式下拉框
---@param typeDropDown X3DropDown 类别下拉框
---@param stateDropDown X3DropDown 状态下拉框
---@param changeCB fun(type:int,type:int,type:int,type:int) 页签、下拉框变化回调
function PhotoAlbumFilter:InitControl(roleTab,modeDropDown,typeDropDown,stateDropDown,changeCB,hideSelf)
    self.roleTab = roleTab
    self.modeDDL = modeDropDown
    self.typeDDL = typeDropDown
    self.stateDDL = stateDropDown
    self.changeCB = changeCB
    self.hideSelf = hideSelf == true

    self:RegisterEvent()

    self:InitRoleData()
    self:InitModeData()
    self:InitTypeData()
    self:InitStateData()

    self.roleTab:Load(#self.roleData)
    self.roleTab:SetIdx(0)

    self.modeDDL:Load(#self.modeData)
    self.modeDDL:SetMenus(self.modeNameData)

    self.typeDDL:Load(#self.typeData)
    self.typeDDL:SetMenus(self.typeNameData)

    self.stateDDL:Load(#self.stateData)
    self.stateDDL:SetMenus(self.stateNameData)
end

function PhotoAlbumFilter:InitPanel(roleID, modeID, typeID, stateID, silent)
    roleID = roleID or -1
    modeID = modeID or -1
    typeID = typeID or -1
    stateID = stateID or -1

    self.roleID = roleID
    self.modeID = modeID
    self.typeID = typeID
    self.stateID = stateID

    self.roleTab:SetIdx(self:GetIndexByValue(self.roleData,self.roleID))
    self.modeDDL:SetIdx(self:GetIndexByValue(self.modeData,self.modeID))
    self.typeDDL:SetIdx(self:GetIndexByValue(self.typeData,self.typeID))
    self.stateDDL:SetIdx(self:GetIndexByValue(self.stateData,self.stateID))

    if not silent then
        self:OnDoCallBack()
    end

    self.IsInit = false
end

function PhotoAlbumFilter:SetRoleTab(roleID)
    roleID = roleID or -1
    self.roleID = roleID
    self.roleTab:SetIdx(self:GetIndexByValue(self.roleData,self.roleID))
end

function PhotoAlbumFilter:RefreshRoleTab(roleId, hideSelf)
    if hideSelf ~= nil and hideSelf ~= self.hideSelf then
        self.hideSelf = hideSelf
        self:InitRoleData()
        self.roleTab:Load(#self.roleData)
    end

    self:SetRoleTab(roleId)
end

function PhotoAlbumFilter:GetIndexByValue(source,value)
    for i = 1, #source do
        if source[i] == value then
            return i-1
        end
    end
    return 0 --没有找到返回
end

function PhotoAlbumFilter:RegisterEvent()
    --角色
    self:AddTabMenuListener(self.roleTab, handler(self, self.OnRoleTabValueChanged), handler(self, self.OnRoleTabLoad))
    --模式
    self:AddDropDownListener(self.modeDDL, handler(self, self.OnModeDDLValueChange))
    --类别 [单人、双人]
    self:AddDropDownListener(self.typeDDL, handler(self, self.OnTypeDDLValueChange))
    --状态
    self:AddDropDownListener(self.stateDDL, handler(self, self.OnStateDDLValueChange))
end

--region 角色页签
function PhotoAlbumFilter:InitRoleData()
    self.roleData = {}
    self.roleNameData = {}
    local allManInfo = LuaCfgMgr.GetListByCondition("RoleInfo",{IsOpen = 1})
    table.sort(allManInfo,function(a,b) return a.Sort < b.Sort end)

    table.insert(self.roleData, -1)
    table.insert(self.roleNameData, UITextHelper.GetUIText(UITextConst.UI_TEXT_7376))
    for i = 1, #allManInfo do
        table.insert(self.roleData, allManInfo[i].ID)
        table.insert(self.roleNameData, UITextHelper.GetUIText(allManInfo[i].Name))
    end

    if not self.hideSelf then
        table.insert(self.roleData, 0)
        table.insert(self.roleNameData, UITextHelper.GetUIText(UITextConst.UI_TEXT_7377))
    end
end

function PhotoAlbumFilter:OnRoleTabLoad(tabMenu, cellItem, index)
    local txtTabName = GameObjectUtil.GetComponent(cellItem,"TabText")
    UIUtil.SetText(txtTabName, self.roleNameData[index+1])
end

function PhotoAlbumFilter:OnRoleTabValueChanged(tabMenu, index, lastIndex)
    if self.IsInit then return end

    self.roleID = self.roleData[index+1]
    self:OnDoCallBack()
end
--endregion

--region 模式信息
function PhotoAlbumFilter:InitModeData()
    self.modeData = {}
    table.insert(self.modeData,-1)
    table.insert(self.modeData,Define.PhotoEditMode.PhotoSticker)
    table.insert(self.modeData,Define.PhotoEditMode.Snapshot)

    self.modeNameData = {}
    table.insert(self.modeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7299))
    table.insert(self.modeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7378))
    table.insert(self.modeNameData, UITextHelper.GetUIText(UITextConst.UI_TEXT_7379))
end

function PhotoAlbumFilter:OnModeDDLValueChange(dropDown, newIndex, oldIndex)
    if self.IsInit then return end

    self.modeID = self.modeData[newIndex+1]
    self:OnDoCallBack()
end

--endregion

--region 照片类型 单人 双人
function PhotoAlbumFilter:InitTypeData()
    self.typeData = {}
    table.insert(self.typeData,GameConst.PhotoMode.All)
    table.insert(self.typeData,GameConst.PhotoMode.Double)
    table.insert(self.typeData,GameConst.PhotoMode.Single)
    table.insert(self.typeData,GameConst.PhotoMode.Other)

    self.typeNameData = {}
    table.insert(self.typeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7300))
    table.insert(self.typeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7380))
    table.insert(self.typeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7381))
    table.insert(self.typeNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7421))
end

function PhotoAlbumFilter:OnTypeDDLValueChange(dropDown, newIndex, oldIndex)
    if self.IsInit then return end

    self.typeID = self.typeData[newIndex+1]
    self:OnDoCallBack()
end

--endregion

--region 照片状态
function PhotoAlbumFilter:InitStateData()
    self.stateData = {}
    table.insert(self.stateData,-1)
    table.insert(self.stateData,1)
    table.insert(self.stateData,0)

    self.stateNameData = {}
    table.insert(self.stateNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7301))
    table.insert(self.stateNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7382))
    table.insert(self.stateNameData,UITextHelper.GetUIText(UITextConst.UI_TEXT_7383))
end

function PhotoAlbumFilter:OnStateDDLValueChange(dropDown, newIndex, oldIndex)
    if self.IsInit then return end

    self.stateID = self.stateData[newIndex+1]

    self:OnDoCallBack()
end

--endregion

function PhotoAlbumFilter:OnDoCallBack()
    if not self.changeCB then return end

    self.changeCB(self.roleID,self.modeID,self.typeID,self.stateID)
end

return PhotoAlbumFilter
