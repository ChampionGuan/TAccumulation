---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by junjun003.
--- DateTime: 2022/7/27 18:07
---

local Base = require("Runtime.System.X3Game.Modules.GamePlayProcedure.ProcedureCtrl.GamePlayState")
---@class UFOCatcherChooseState : GamePlayState
local UFOCatcherChooseState = class("UFOCatcherChooseState", Base)

---@type UFOCatcherBLL
local BLL = BllMgr.GetUFOCatcherBLL()

---状态进入
function UFOCatcherChooseState:OnEnter()
    EventMgr.Dispatch("UFOCatcherPanel_Show")
    EventMgr.Dispatch("UFOCatcherPanel_ShowFunctionPanel")
    EventMgr.Dispatch("UFOCATCHEREVENT_UFOCATCHERSTATE_ENTERCHOOSE", nil)
    if table.nums(BLL.dollPoolDict) <= 1 then
        self.owner:CurrentDialogueSystem():ChangeVariableState(12, -1)
    end
    self.owner:ClearBetweenState()
    self.owner:CheckEventToPlay(handler(self, self.CheckEventCallback), false)
end

---事件检查结束
function UFOCatcherChooseState:CheckEventCallback()
    self.owner:GotoNextState()
end

---状态进入
function UFOCatcherChooseState:GotoNextState()
    self.owner:ChangeState(UFOCatcherGameState.Moving)
end

---状态退出
function UFOCatcherChooseState:OnExit(nextState)
    EventMgr.Dispatch("UFOCATCHEREVENT_UFOCATCHERSTATE_QUITCHOOSE", nil)
    if self.owner.gameMode == GamePlayConst.GameMode.AI then
        self.owner:DecideCatchTarget()
    end
end

return UFOCatcherChooseState