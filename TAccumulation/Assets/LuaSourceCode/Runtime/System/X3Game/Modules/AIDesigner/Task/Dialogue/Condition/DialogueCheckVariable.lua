---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by junjun003.
--- DateTime: 2021/12/16 11:07
---

local DialogueCondition = require("Runtime.System.X3Game.Modules.AIDesigner.Task.Dialogue.Condition.DialogueCondition")

---Category:Dialogue
---@class DialogueCheckVariable:DialogueCondition
---@field key int|AIVar 变量Key
---@field operation ComparisonOperation|Int
---@field value int|AIVar 变量Value
local DialogueCheckVariable = class("DialogueCheckVariable", DialogueCondition)

---@return AITaskState
function DialogueCheckVariable:OnUpdate()
    if self.dialogueController ~= nil then
        local curValue = self.dialogueController:GetVariableState(self.key:GetValue())
        if self.operation == ComparisonOperation.LessThan then
            return curValue < self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        elseif self.operation == ComparisonOperation.LessThanOrEqualTo then
            return curValue <= self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        elseif self.operation == ComparisonOperation.EqualTo then
            return curValue == self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        elseif self.operation == ComparisonOperation.NotEqualTo then
            return curValue ~= self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        elseif self.operation == ComparisonOperation.GreaterThanOrEqualTo then
            return curValue >= self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        elseif self.operation == ComparisonOperation.GreaterThan then
            return curValue > self.value:GetValue() and AITaskState.Success or AITaskState.Failure
        end
        return AITaskState.Failure
    else
        Debug.LogError("没有为AI注入DialogueController，请检查。")
        return AITaskState.Failure
    end
end

return DialogueCheckVariable