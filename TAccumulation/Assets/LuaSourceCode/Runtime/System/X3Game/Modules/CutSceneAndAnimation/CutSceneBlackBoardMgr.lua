---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by junjun003.
--- DateTime: 2023/8/8 20:51
---

---@class CutSceneBlackBoardMgr
local CutSceneBlackBoardMgr = {}
local CS_BlackBoardHelper = CS.PapeGames.CutScene.X3CutSceneBlackBoardHelper

---@type table<string, CmdCache[]>
local cmdCacheDict = nil

---@class CmdCache
---@field cmdType int
---@field cmdObj CS.PapeGames.CutScene.BlackBoard.ICommand

---初始化
function CutSceneBlackBoardMgr.Init()
    cmdCacheDict = {}
end

---添加一个Command
---@param targetKey string
---@param cmdCache CmdCache
local AddCommand = function(targetKey, cmdCache)
    if cmdCacheDict[targetKey] == nil then
        cmdCacheDict[targetKey] = {}
    end
    local cacheList = cmdCacheDict[targetKey]
    table.insert(cacheList, #cacheList + 1, cmdCache)
end

---设置某个目标的显隐
---@param targetKey string
---@param visible boolean
function CutSceneBlackBoardMgr.SetVisible(targetKey, visible)
    CutSceneBlackBoardMgr.RemoveByType(targetKey, GameConst.CTSCommandType.Visible)
    local cmd = CS_BlackBoardHelper.SetVisible(targetKey, visible)
    local cmdCache = { cmdType = GameConst.CTSCommandType.Visible, cmdObj = cmd }
    AddCommand(targetKey, cmdCache)
end

---移除所有特定类型的Command
---@param targetKey string 目标Key
---@param cmdType CommandType
function CutSceneBlackBoardMgr.RemoveByType(targetKey, cmdType)
    local cacheList = cmdCacheDict[targetKey]
    if cacheList ~= nil then
        for i = #cacheList, 1, -1 do
            local cmdCache = cacheList[i]
            if cmdCache.cmdType == cmdType then
                CS_BlackBoardHelper.Remove(cmdCache.cmdObj)
                cmdCache.cmdObj = nil
                table.remove(cacheList, i)
            end
        end
    end
end

---
function CutSceneBlackBoardMgr.Reset()
    CS_BlackBoardHelper.Clear()
end

---
function CutSceneBlackBoardMgr.Clear()
    CutSceneBlackBoardMgr.Reset()
    table.clear(cmdCacheDict)
    cmdCacheDict = nil
end

return CutSceneBlackBoardMgr