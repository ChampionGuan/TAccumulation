---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/6/2 10:19
---
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
---@class CatCard.MoveCardPosAction:CatCard.CatCardBaseAction
local MoveCardPosAction = class("MoveCardPosAction",BaseAction)
---@param action_data CatCard.MoveCardPosActionData
function MoveCardPosAction:Begin(action_data)
    local idx = action_data:GetPosIndex()
    local player_type = action_data:GetPlayerType()
    local card_type = CatCardConst.CardType.CARD
    if action_data:IsFill() then
        self:MoveModelByFillIdx(card_type,idx,player_type)
    else
        self:MoveModelByAddIdx(card_type,idx,player_type)
    end
    self:End()
end

function MoveCardPosAction:End()
    BaseAction.End(self)
end

---@param card_type CatCardConst.CardType
---@param index int
---@param player_type CatCardConst.PlayerType
function MoveCardPosAction:MoveModelByAddIdx(card_type,index,player_type)
    if index>= CatCardConst.MAX_CARD_COUNT then
        return
    end
    for i = CatCardConst.MAX_CARD_COUNT,index,-1 do
        local model = self:GetModel(card_type,i,player_type)
        if model and model:IsValid() then
            self:RemoveModel(card_type,i,player_type)
            self:RefreshModel(card_type,i+1,player_type)
        end
    end
end

---@param card_type CatCardConst.CardType
---@param index int
---@param player_type CatCardConst.PlayerType
function MoveCardPosAction:MoveModelByFillIdx(card_type,index,player_type)
    if index>= CatCardConst.MAX_CARD_COUNT then
        return
    end
    for i = index+1,CatCardConst.MAX_CARD_COUNT do
        local model = self:GetModel(card_type,i,player_type)
        if model and model:IsValid() then
            self:RemoveModel(card_type,i,player_type)
            self:RefreshModel(card_type,i-1,player_type)
        else
            break
        end
    end
end

return MoveCardPosAction