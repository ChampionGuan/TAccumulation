---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/6/15 21:29
--- 默认pipeline
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.BaseActionPipeline
local BasePipeline = require(CatCardConst.BASE_PIPELINE_LUA_PATH)
---@class CatCard.DefaultPipeline:CatCard.BaseActionPipeline
local DefaultPipeline = class("DefaultPipeline", BasePipeline)

function DefaultPipeline:Begin()
    BasePipeline.Begin(self)
    if self:IsActionFinish() then
        self:End()
        return
    end
    self:ExecuteAction(self:GetValidAction())
    local actionList = self.dataParser:GetActionDataList()
    for k, v in pairs(actionList) do
        if not v:IsRunning() and v:IsParallel() then
            self:ExecuteAction(v)
        end
    end
end

function DefaultPipeline:OnGamePause()
    for k, v in pairs(self.dataParser:GetActionDataList()) do
        v:Pause()
    end
end

function DefaultPipeline:OnGameResume()
    for k, v in pairs(self.dataParser:GetActionDataList()) do
        v:Resume()
    end
end

function DefaultPipeline:OnRemoveEventListener()
    EventMgr.RemoveListenerByTarget(self)
end

function DefaultPipeline:OnAddEventListener()
    EventMgr.AddListener(CatCardConst.Event.CAT_CARD_GAME_PAUSE, self.OnGamePause, self)
    EventMgr.AddListener(CatCardConst.Event.CAT_CARD_GAME_RESUME, self.OnGameResume, self)
end

function DefaultPipeline:End()
    BasePipeline.End(self)
end

return DefaultPipeline