---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2020/11/24 19:56
---
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
local CatCardBaseEffect = class("CatCardBaseEffect")

function CatCardBaseEffect:ctor()
    self.effect_map = {}
end

function CatCardBaseEffect:IsRunning()
    return self.is_running
end

function CatCardBaseEffect:SetIsRunning(is_running)
    self.is_running = is_running
    self.bll:CheckRunning()
end

function CatCardBaseEffect:SetOwner(owner)
    self.owner = owner
    self.logic_ctrl = self.owner:GetCtrl(CatCardConst.Ctrl.LOGIC)
end

function CatCardBaseEffect:SetBll(bll)
    self.bll = bll
end

function CatCardBaseEffect:Execute(...)

end

function CatCardBaseEffect:GetEffect(effect_name,parent,is_create)
    local effect
    local map = self.effect_map[parent]
    if not map then
        map = {}
        self.effect_map[parent] = map
    end
    effect = map[effect_name]
    if not effect and is_create then
        effect = self.logic_ctrl:LoadEffect(effect_name,parent)
        map[effect_name] = effect
    end
    return effect
end

function CatCardBaseEffect:Play(...)
    local effect_state,effect_name,parent = select(1,...)
    if effect_state == CatCardConst.EffectState.SHOW then
        self:Show(effect_name,parent)
    elseif effect_state == CatCardConst.EffectState.HIDE then
        self:Hide(effect_name,parent)
    else
        if self.bll:IsDebugMode() then
            self.bll:Log("[CatCardBaseEffect:Play]---failed:",...)
        end
    end
end

function CatCardBaseEffect:Show(effect_name,parent)
    local effect = self:GetEffect(effect_name,parent,true)
    GameObjectUtil.SetActive(effect,true)
    self:OnEnd(effect_name,parent)
end

function CatCardBaseEffect:Hide(effect_name,parent)
    local effect = self:GetEffect(effect_name,parent)
    if effect then
        EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_ADD_EFFECT_TO_POOL,effect_name,effect)
    end
    self:OnEnd(effect_name,parent)
    self:ClearEffect(effect_name,parent)
end

function CatCardBaseEffect:ClearEffect(effect_name,parent)
    local map = self.effect_map[parent]
    if map then
        map[effect_name] = nil
        if table.isnilorempty(map) then
            self.effect_map[parent] = nil
        end
    end
end

function CatCardBaseEffect:Enter()

end

function CatCardBaseEffect:Exit()
    GameUtil.ClearTarget(self)
end


function CatCardBaseEffect:OnEnd(effect_name,parent)
    local map = self.effect_map[parent]
    if map  then
        map = map[effect_name]
        if map then
            if map.call then
                map.call()
            end
        end
    end
end

return CatCardBaseEffect