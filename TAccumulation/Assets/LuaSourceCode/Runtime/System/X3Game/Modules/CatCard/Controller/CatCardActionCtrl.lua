---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2020/8/28 21:39
---
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
local CatCardBaseCtrl = require(CatCardConst.BASE_CTRL_PATH)
---@class CatCardActionCtrl:BaseCatCardCtrl
local CatCardActionCtrl = class("CatCardActionCtrl",CatCardBaseCtrl)

function CatCardActionCtrl:GetTypeMap()
    return CatCardConst.SpecialType
end

function CatCardActionCtrl:GetHandler(action_type)
    if not action_type then return end
    local action = self.node_map[action_type]
    if not action then
        local path =  CatCardConst.ActionConf[action_type]
        if self.bll:IsInGuide() and CatCardConst.GuideActionConf[action_type] then
            path = CatCardConst.GuideActionConf[action_type]
        end
        if path then
            action = require(path).new()
            action:SetType(action_type)
            action:SetOwner(self)
            action:Enter()
            self.node_map[action_type] = action
        end
    end
    return action
end

--显示神游相关的状态
--刚开始的时候，除了可开始阶段，其他状态全部不考虑，直接进行其他流程
function CatCardActionCtrl:Check(action_type,...)
    local pre_action = self.action_type
    if pre_action~= action_type then
        self.action_type = action_type
        EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_ACTION_TYPE_CHANGE,action_type)
    end

    local action  = self:GetHandler(action_type)
    if action then
        action:Execute(...)
    else
        EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_CHECK_SPECIAL_STATE)
    end
end

function CatCardActionCtrl:Enter()
    self.super.Enter(self)
end

function CatCardActionCtrl:Exit()
    self.super.Exit(self)
end
return CatCardActionCtrl