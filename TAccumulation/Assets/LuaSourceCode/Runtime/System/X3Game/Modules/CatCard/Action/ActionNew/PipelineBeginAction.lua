---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/6/24 20:34
--- pipeline 开始的时候预处理
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
---@class CatCard.PipelineBeginAction:CatCard.CatCardBaseAction
local PipelineBeginAction = class("PipelineBeginAction", BaseAction)

---@param action_data CatCard.BaseActionData
function PipelineBeginAction:Begin(action_data)
    BaseAction.Begin(self)
    self:UnselectAllTarget()
    self.playerType = action_data:GetPlayerType()
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_MAIN_TIP_INFO_REFRESH)
    self:CheckFuncPileCount()
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_SET_SELECT_ENABLE,false)
    self:End()
end

function PipelineBeginAction:CheckFuncPileCount()
    if self.bll:GetMode() ~= CatCardConst.ModeType.Func then
        return
    end
    local stateData = self.bll:GetStateData()
    if stateData:GetFuncPileCount() > 0 then
        return
    end
    if stateData:GetLastPlayerType() ~= self.playerType then
        if self.bll:IsState(CatCardConst.PlayerType.PLAYER) then
            if stateData:GetPopState() == CatCardConst.PopCardState.PopFuc then
                UICommonUtil.ShowMessage(UITextConst.UI_TEXT_35004)
            end
        end
        stateData:SetLastPlayerType(self.playerType)
    end

end

return PipelineBeginAction
