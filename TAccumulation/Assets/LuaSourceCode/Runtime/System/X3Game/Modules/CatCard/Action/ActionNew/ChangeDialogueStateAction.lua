---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by canghai.
--- DateTime: 2023/1/10 15:35
---

---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
---@class CatCard.ChangeDialogueStateAction:CatCard.CatCardBaseAction
local ChangeDialogueStateAction = class("ChangeDialogueStateAction", BaseAction)
---防止Callback为空
local EmptyCallback = function() end

---@param action_data CatCard.ChangeDialogueStateActionData
function ChangeDialogueStateAction:Begin(action_data)
    self.state = action_data:GetState()
    self.dialogueCtrlState = action_data:GetDialogueCtrlState()
    ---@type CatCardDialogueCtrl
    local dialogueCtrl = self:GetCtrl(CatCardConst.Ctrl.Dialogue)
    if action_data:IsWait() then
        dialogueCtrl:ChangeDialogueState(self.state, self.dialogueCtrlState, handler(self, self.End))
    else
        dialogueCtrl:ChangeDialogueState(self.state, self.dialogueCtrlState, EmptyCallback)
        self:End()
    end
end

function ChangeDialogueStateAction:End()
    if not self:IsRunning() then
        return
    end
    
    BaseAction.End(self)
end

---强制结束当前节点的剧情
function ChangeDialogueStateAction:ForceEnd()
    ---@type CatCardDialogueCtrl
    local dialogueCtrl = self:GetCtrl(CatCardConst.Ctrl.Dialogue)
    dialogueCtrl:ChangeDialogueState(self.state, CatCardConst.DialogueCtrlState.Stop, EmptyCallback)
end

return ChangeDialogueStateAction