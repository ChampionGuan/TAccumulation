---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2020/9/1 17:08
---

local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCardBaseLogic
local BaseLogic = require(CatCardConst.BASE_LOGIC_PATH)
---@class CardStackLogic:CatCardBaseLogic
local CardStackLogic = class("CardStackLogic", BaseLogic)

function CardStackLogic:Init()
    local bll = self.bll or BllMgr.GetCatCardBLL()
    local stData = bll:GetStateData()
    local mode = stData:GetMode()
    self.stacks = PoolUtil.GetTable()
    if mode == CatCardConst.ModeType.Func then
        self:SetActive("CenterCardStack", false)
        self:SetActive("CenterFuncCardStack", true)
        self.stacks[CatCardConst.SubType.NORMALCARD] = self:GetComponent("CenterFuncCardStack/CenterNum/GetCardPos")
        self.stacks[CatCardConst.SubType.FUNCCARD] = self:GetComponent("CenterFuncCardStack/CenterFunc/GetCardPos")
    else
        self:SetActive("CenterCardStack", true)
        self.stacks[CatCardConst.SubType.NORMALCARD] = self:GetComponent("CenterCardStack/Center/GetCardPos")
    end
end

function CardStackLogic:CheckFuncCardStack()

    local bll = self.bll or BllMgr.GetCatCardBLL()
    local stData = bll:GetStateData()
    local mode = stData:GetMode()
    if mode == CatCardConst.ModeType.Func then
        local count = stData:GetFuncPileCount()
        local is_visible = count > 0
        if is_visible then
            for k, v in ipairs(CatCardConst.FuncStackNode) do
                self:SetActive(v, k <= count)
            end
        end
        self:SetActive(CatCardConst.FUNC_CARD_STACK_NODE, is_visible)
        local numCount = stData:GetNumPileCount()
        self:SetActive(CatCardConst.Num_CARD_STACK_NODE, numCount > 0)
    end
end

function CardStackLogic:Refresh()

end

---获取牌堆位置节点
---@param subType CatCardConst.SubType
---@return GameObject
function CardStackLogic:GetStackPosNode(subType)
    subType = subType and subType or CatCardConst.SubType.NORMALCARD
    return self.stacks[subType]
end

---牌堆逻辑点击的时候需要设置的
function CardStackLogic:IsTouchEnable()
    return self.is_touch_enable
end

return CardStackLogic