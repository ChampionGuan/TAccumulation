---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xiaofang.
--- DateTime: 2023/1/7 11:33
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
---@class CatCard.EnemyStealAction:CatCard.CatCardBaseAction
local EnemyStealAction = class("EnemyStealAction", BaseAction)

---@param action_data CatCard.EnemyStealActionData
function EnemyStealAction:Begin(action_data)
    self.bll:RestoreCards()
    self.stateData = self.bll:GetStateData()
    self.player_type = CatCardConst.PlayerType.ENEMY
    self.card_index = action_data:GetCardIndex(self.player_type)
    self.card_id = CatCardConst.DEFAULT_CARD_ID
    local data = self.bll:GetData(CatCardConst.CardType.CARD, self.card_index, self.player_type)
    if data then
        self.card_id = data:GetId()
    end
    self:PlayGetCard()
end

function EnemyStealAction:PlayGetCard()
    if self.card_id == 0 then
        self:End()
        return
    end
    ---@type CatCard.GetCardActionData
    local get_card = self.bll:GetActionData(CatCardConst.ActionType.GetCard, self.player_type, handler(self, self.End))
    get_card:Set(self.card_id, self.card_index)
    get_card:Begin()
end

function EnemyStealAction:End()
    self.stateData:SetStealCardId(0)
    self.stateData:SetSpState(CatCardConst.StealState.END)
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_REFRESH_MODEL, CatCardConst.CardType.CARD, self.card_index, self.player_type)
    BaseAction.End(self)
end

return EnemyStealAction