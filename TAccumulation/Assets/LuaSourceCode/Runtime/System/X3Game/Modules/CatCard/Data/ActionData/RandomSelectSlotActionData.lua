---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hongyun.
--- DateTime: 2022/7/18 14:23
---

---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.BaseActionData
local BaseActionData = require(CatCardConst.BASE_ACTION_DATA_PATH)

---男主随机选择格子效果的ActionData
---@class CatCard.RandomSelectSlotActionData:CatCard.BaseActionData
local RandomSelectSlotActionData = class("RandomSelectSlotActionData", BaseActionData)

function RandomSelectSlotActionData:ctor()
    BaseActionData.ctor(self)

    ---功能牌类型
    ---@type CatCardConst.FuncCardType
    self.funcCardType = nil

    ---最终要选择到的格子位置，随机最后一次选择的格子不能与此重复
    ---@type int
    self.finalSlot = nil
    ---@type int
    self.randomNum = 0 --随机数量
end

---@param type CatCardConst.FuncCardType
function RandomSelectSlotActionData:SetFuncCardType(type)
    self.funcCardType = type
end

---@return CatCardConst.FuncCardType
function RandomSelectSlotActionData:GetFuncCardType()
    return self.funcCardType
end

---@param finalSlot int
function RandomSelectSlotActionData:SetFinalSlot(finalSlot)
    self.finalSlot = finalSlot
end

---@return int
function RandomSelectSlotActionData:GetFinalSlot()
    return self.finalSlot
end

---@param selectableNum int 可选格子数量
---@return float 间隔时间，随机次数
function RandomSelectSlotActionData:GetRandomInfo(selectableNum)
    if self.funcCardType == CatCardConst.FuncCardType.DISCOLORCARD then
        --变色喵
        local cfg = LuaCfgMgr.Get("MiaoCardControl", CatCardConst.RandomControlType.ChangeColor)
        if cfg then
            local aniNum = cfg.AnimNum > 0 and cfg.AnimNum / 1000 or 0.5
            return aniNum, cfg.RandomNum
        end
    else
        for i = CatCardConst.RandomControlType.FuncRandomOne, CatCardConst.RandomControlType.FuncRandomFour do
            local cfg = LuaCfgMgr.Get("MiaoCardControl", i)
            if cfg then
                if ConditionCheckUtil.IsInRange(selectableNum, cfg.SlotNum[1], cfg.SlotNum[2]) then
                    local aniNum = cfg.AnimNum > 0 and cfg.AnimNum / 1000 or 0.5
                    return aniNum, cfg.RandomNum
                end
            end
        end
    end
    return 0.5, selectableNum
end

---@param type CatCardConst.FuncCardType
---@param finalSlot int
function RandomSelectSlotActionData:Set(type, finalSlot)
    self:SetFuncCardType(type)
    self:SetFinalSlot(finalSlot)
end

return RandomSelectSlotActionData