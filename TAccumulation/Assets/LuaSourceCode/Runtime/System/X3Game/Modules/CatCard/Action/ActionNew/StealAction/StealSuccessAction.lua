---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xiaofang.
--- DateTime: 2023/1/7 11:34
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
---@class CatCard.StealSuccessAction:CatCard.CatCardBaseAction
local StealSuccessAction = class("StealSuccessAction", BaseAction)

---@param action_data CatCard.StealSuccessActionData
function StealSuccessAction:Begin(action_data)
    self.stateData = self.bll:GetStateData()
    self.playerType = CatCardConst.PlayerType.PLAYER
    action_data:SetPlayerType(self.playerType)
    self.card_index = action_data:GetCardIndex()
    self.card_id = action_data:GetCardId()
    if self.card_id == 0 then
        local data = self.bll:GetData(CatCardConst.CardType.CARD, self.card_index, self.playerType)
        if data then
            self.card_id = data:GetId()
        end
    end
    self:PlayGetCard()
end

function StealSuccessAction:PlayGetCard()
    if self.card_id == 0 then
        self:End()
        return
    end
    ---@type CatCard.GetCardActionData
    local get_card = self.bll:GetActionData(CatCardConst.ActionType.GetCard, self.playerType, handler(self, self.End))
    get_card:Set(self.card_id, self.card_index)
    get_card:Begin()
end

function StealSuccessAction:End()
    self.stateData:SetStealCardId(0)
    self.stateData:SetSpState(CatCardConst.StealState.END)
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_REFRESH_MODELS)
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_REFRESH_MODEL, CatCardConst.CardType.CARD, self.card_index, self.playerType)
    BaseAction.End(self)
end

return StealSuccessAction