---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xiaofang.
--- DateTime: 2022/12/30 18:36
---悔牌结束
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
-----@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
-----@class CatCard.RegretEndAction:CatCard.CatCardBaseAction
local RegretEndAction = class("RegretEndAction", BaseAction)

---@param actionData CatCard.RegretEndActionData
function RegretEndAction:Begin(actionData)
    self.stateData = self.bll:GetStateData()
    self.regretState = self.stateData:GetSpState()
    if self.regretState == CatCardConst.RegretState.END then
        self.stateData:ClearActionRes()
        self.stateData:ClearRecord()
        EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_ON_SELECT_MODEL)
    elseif self.regretState == CatCardConst.RegretState.CAUGHTSUC_MINECHANGE then
        self.bll:CheckPipeline(CatCardConst.ActionPipelineType.Default, { Seat = CatCardConst.SeatType.PLAYER, SPAction = { args = { CatCardConst.RegretState.CAUGHTSUC_MINECHANGE }, id = CatCardConst.SpecialType.REGRET } })
        actionData:SetIsBreak(true)
    else
        actionData:SetIsBreak(true)
    end
    EventMgr.Dispatch(CatCardConst.Event.CAT_CARD_REFRESH_MODELS, CatCardConst.CardType.CARD, true)
    self:End()
end

return RegretEndAction
