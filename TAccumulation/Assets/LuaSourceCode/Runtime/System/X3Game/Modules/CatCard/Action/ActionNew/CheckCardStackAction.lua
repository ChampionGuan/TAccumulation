---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/6/20 22:14
---检测已出牌相关堆栈信息
---@type CatCardConst
local CatCardConst = require("Runtime.System.X3Game.Modules.CatCard.Data.CatCardConst")
---@type CatCard.CatCardBaseAction
local BaseAction = require(CatCardConst.BASE_ACTION_PATH_NEW)
local card_id = nil
local player_type = nil
---@class CatCard.CheckCardStackAction:CatCard.CatCardBaseAction
local CheckCardStackAction = class("CheckCardStackAction", BaseAction)
---@param action_data CatCard.CheckCardStackActionData
function CheckCardStackAction:Begin(action_data)
    local data = action_data:GetData()
    if data then
        if data:IsFuncCard() then
            self.bll:SetFuncEffectEndState(false)
            if data:GetEffectId() ~= CatCardConst.FuncCardType.VETOCARD then
                player_type = action_data:GetPlayerType()
                card_id = action_data:GetCardId()
                if player_type == CatCardConst.PlayerType.PLAYER then
                    self.bll:SetSourceFuncCard(card_id)
                end
                if action_data:IsCanShowCard() then
                    self:SetCardShow(true)
                end
            end
        end
    else
        self:SetCardShow(false)
        card_id = nil
        player_type = nil
    end
    self:End()
end

---@param isShow boolean
function CheckCardStackAction:SetCardShow(isShow)
    if player_type == CatCardConst.PlayerType.PLAYER then
        return
    end
    ---@type CatCard.ShowCardActionData
    local data = self.bll:GetActionData(CatCardConst.ActionType.ShowCardAction, player_type)
    data:Set(card_id, isShow)
    data:Begin()
end

return CheckCardStackAction