---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiantao.
--- DateTime: 2023/10/17 14:42
---
---@type BaseGameState
local BaseGameState = require("Runtime.System.X3Game.Modules.GameStateMgr.BaseGameState")
---@class ReturnActivityState
local ReturnActivityState = class("ReturnActivityState", BaseGameState)

function ReturnActivityState:ctor()

end

function ReturnActivityState:OnEnter(prevStateName, isFirst, callBack)
    self.super.OnEnter(self)
    local sceneName = BllMgr.GetReturnActivityBll():GetSceneName(isFirst)
    if isFirst then
        local loadingType
        local weight = 1
        local startProgress = 0
        if BllMgr.GetHeadIconBLL():IsShowLoading() then
            loadingType = GameConst.LoadingType.FaceEditHeadIcon
            weight, startProgress = BllMgr.GetHeadIconBLL():GetLoadingWeightAndProgress()
            BllMgr.GetHeadIconBLL():EndLoading()
        else
            loadingType = GameConst.LoadingType.Common
        end
        ResBatchLoader.ClearTasks()
        ResBatchLoader.AddSceneTask(sceneName, 1.0)
        ResBatchLoader.LoadAsync(loadingType, false, function()
            UICommonUtil.SetLoadingEnable(loadingType, false)
            BllMgr.GetReturnActivityBll():StartFirstDialogue()
        end, nil, weight, startProgress)
    else
        UICommonUtil.WhiteScreenIn(function()
            UIMgr.Open(UIConf.SpecialDatePlayWnd)
            SceneMgr.LoadSceneAsync(sceneName, nil, GameConst.LoadingType.None, function(taskID)
                BllMgr.GetReturnActivityBll():LoadRole(BllMgr.GetReturnActivityBll():GetCurRoleID(), function()
                    UICommonUtil.ClearScreen()
                    BllMgr.GetReturnActivityBll():StartRoleDialogue(BllMgr.GetReturnActivityBll():GetCurRoleID(), isFirst)
                end, true)

            end, true)
        end)

    end
end



function ReturnActivityState:OnExit(nextStateName)
    self.super.OnExit(self)
    BllMgr.GetReturnActivityBll():DesRole()
end

return ReturnActivityState