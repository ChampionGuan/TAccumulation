---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by muchen.
--- DateTime: 2022/9/22 11:27
---
---@class DisconnectionState
local DisconnectionState = class("DisconnectionState", require("Runtime.System.X3Game.Modules.GameStateMgr.BaseGameState"))

function DisconnectionState:ctor()

end

function DisconnectionState:OnEnter(prevStateName,changeType)
    self.super.OnEnter(self)
    ---提前打开loading，防止切换横竖屏出问题
    UICommonUtil.SetLoadingEnable(GameConst.LoadingType.Common, true)
    if prevStateName == GameState.Battle then
        g_battleLauncher:SetShutdownCompletedFunc(function()
            self:InternalEnter(changeType)
        end)
    else
        self:InternalEnter(changeType)
    end
end

function DisconnectionState:InternalEnter(changeType)
    UIMgr.SetPortraitMode(function()
        if changeType then
            CS.X3Game.GameMgr.LanguageChangeType = changeType
            ---先清理再解压，防止require句柄占用导致解压失败
            UITextHelper.Clear()
            CS.X3Game.X3LuaBuilder.XFileMgr.Clear()
            CS.X3Game.X3LuaBuilder.LuaFileHelper.ExtraAll()
        end
        CS.X3Game.GameMgr.IsReconnect = true
        ---这里不需要判断热更
        GameMgr.ReStart(false , GameState.Reconnection , true, changeType ~= nil)
    end)
end

function DisconnectionState:OnExit(nextStateName)
    self.super.OnExit(self)
end

return DisconnectionState