---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by deling.
--- DateTime: 2023/5/29 13:22
---

---仅为本地快速打包DEBUG使用
require("Runtime.System.X3Game.Modules.UICommon.UICommonInit")

local FastBuildState = class("FastBuildState", require("Runtime.System.X3Game.Modules.GameStateMgr.BaseGameState"))


function FastBuildState:ctor()
    self.Name = "FastBuildState"
end

function FastBuildState:OnEnter(prevStateName, firstStart)
    self.super.OnEnter(self)

    --提前初始化Cts相关表格，防止Lazy模式第一次初始化json解析卡顿
    local tableToMessagePacker = PoolUtil.GetTable()
    local partConfigAll = table.clone(LuaCfgMgr.GetAll("PartConfig"), true)
    if partConfigAll then
        table.dictoarray(partConfigAll, tableToMessagePacker)
        CS.X3.Testbed.TablePartConfig.Inject(tableToMessagePacker)
        table.clear(tableToMessagePacker)
    end

    local modelAssetAll = table.clone(LuaCfgMgr.GetAll("ModelAsset"), true)
    if modelAssetAll then
        table.dictoarray(modelAssetAll, tableToMessagePacker)
        CS.X3.Testbed.TableModelAsset.Inject(tableToMessagePacker)
        table.clear(tableToMessagePacker)
    end
    local cutSceneAssetAll = table.clone(LuaCfgMgr.GetAll("CutSceneAsset"), true)
    if cutSceneAssetAll then
        table.dictoarray(cutSceneAssetAll, tableToMessagePacker)
        CS.PapeGames.CutScene.CutSceneAssetCfg.Inject(tableToMessagePacker)
        table.clear(tableToMessagePacker)
    end
    PoolUtil.ReleaseTable(tableToMessagePacker)
    
    
    ---AppInfo初始化
    local csAppInfoMgr = CS.X3Game.AppInfoMgr.Instance
    local appInfo = csAppInfoMgr.AppInfo
    ServerUrl:SetCmsUrl(appInfo.CmsUrl)
    ServerUrl:SetSdkUrl(appInfo.SdkUrl)
    ServerUrl:SetClientId(appInfo.ClientId)
    ServerUrl:SetClientKey(appInfo.ClientKey)
    ServerUrl:SetRoleAuthority(appInfo.roleAuthority)
    ServerUrl:SetSupportUrl(appInfo.supportUrl)
    Const.AppP4Version = appInfo.p4Ver
    
    ---set frame rate
    CS.UnityEngine.Application.targetFrameRate = 30
    ---GM
    CS.X3Game.GMCommandManager.Init()
end


function FastBuildState:OnExit()
    self.super.OnEnter(self)
end

return FastBuildState
