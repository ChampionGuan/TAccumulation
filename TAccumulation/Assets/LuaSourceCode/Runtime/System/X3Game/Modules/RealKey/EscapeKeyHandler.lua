---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jianxin.
--- DateTime: 2022/10/19 15:39
---

local EscapeKeyHandler = class("EscapeKeyHandler")

local CS_EscapeKeyHandler = nil

local SpecialViewTab = {
    "LoginWnd",
    "MainHomeWnd",
}

function EscapeKeyHandler:Init()
    CS_EscapeKeyHandler = CS.X3Game.EscapeKeyHandler.Attach()
    if CS_EscapeKeyHandler ~= nil then
        CS_EscapeKeyHandler:ClearSpecialViewList()
        for i, v in ipairs(SpecialViewTab) do
            CS_EscapeKeyHandler:AddSpecialViewTag(v)
        end
        CS_EscapeKeyHandler:AddSpecialViewCallBack(handler(self, self.ShowQuitMessage))
    end
    ---新手引导进入清理弹窗
    EventMgr.AddListener(NoviceGuideDefine.Event.GUIDE_START, self.CloseMessageBox, self)
end

function EscapeKeyHandler:ShowQuitMessage()
    if BllMgr.GetNoviceGuideBLL():IsInGuide() then
        ---新手引导状态中不弹弹窗
        return
    end
    if GameStateMgr.GetCurStateName() == GameState.MainHome and (not BllMgr.GetMainHomeBLL():GetTouchEnableAndNoInteract()) then
        ---主界面非交互状态不弹出弹窗
        Debug.Log("主界面不能点击")
        return
    end
    self.messageBoxID = UICommonUtil.ShowMessageBox(UITextConst.UI_TEXT_5719, { { btn_type = GameConst.MessageBoxBtnType.CONFIRM, btn_call = function()
        SDKMgr.ApplicationQuit()
    end, is_auto_close = false }, { btn_type = GameConst.MessageBoxBtnType.CANCEL, btn_call = function()
        self.messageBoxID = nil
    end } })
end

function EscapeKeyHandler:CloseMessageBox()
    if self.messageBoxID ~= nil then
        UICommonUtil.CloseMessageBox(self.messageBoxID)
        self.messageBoxID = nil
    end
end

EscapeKeyHandler:Init()

return EscapeKeyHandler
