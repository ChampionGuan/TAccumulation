---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by muchen.
--- DateTime: 2021/8/30 16:09
---
---@class WeaponUtil 武器相关接口
local WeaponUtil = class("WeaponUtil")

---设置武器部件
function WeaponUtil.SetWeaponSkin(roleBaseGo, curSkinId, preSkinId, isAddPlayerAnimation)
    if GameObjectUtil.IsNull(roleBaseGo) then
        return
    end
    if isAddPlayerAnimation == nil then
        isAddPlayerAnimation = true
    end
    if preSkinId == nil then
        preSkinId = 0
    end
    local CurWeaponSkinCfg = BllMgr.GetWeaponBLL():GetWeaponSkinConfig(curSkinId)
    if preSkinId > 0 then
        local preWeaponSkinCfg = BllMgr.GetWeaponBLL():GetWeaponSkinConfig(preSkinId)
        if preWeaponSkinCfg then
            WeaponUtil.ClearSkinWeapon(roleBaseGo, preWeaponSkinCfg)
        end
    end
    local partCfgId = CurWeaponSkinCfg.PartConfigID
    if partCfgId~=nil then
        for i = 1, #partCfgId do
            CharacterMgr.AddPart(roleBaseGo, partCfgId[i])
        end
    end
    if isAddPlayerAnimation then
        WeaponUtil.AddPlayerAnimation(roleBaseGo, WeaponUtil.GetWeaponType(CurWeaponSkinCfg), CurWeaponSkinCfg)
    end
end
--清除人物武器部件
function WeaponUtil.ClearSkinWeapon(roleBaseGo, weaponSkinCfg)
    if GameObjectUtil.IsNull(roleBaseGo) then
        return
    end
    if weaponSkinCfg then
        local removePartCfgId = weaponSkinCfg.PartConfigID
        for i = 1, #removePartCfgId do
            CharacterMgr.RemovePart(roleBaseGo, removePartCfgId[i])
        end
    end
end
--获取weaponType
function WeaponUtil.GetWeaponType(weaponSkinCfg)
    if weaponSkinCfg then
        local weaponID = weaponSkinCfg.WeaponID
        local weaponCfg = LuaCfgMgr.Get("MyWeapon", weaponID)
        return weaponCfg.WeaponType
    end
    return 0
end
-- 播放武器动画
function WeaponUtil.AddPlayerAnimation(roleBaseGo, weaponType, curWeaponSkinCfg)
    if GameObjectUtil.IsNull(roleBaseGo) then
        return
    end
    local weaponData = LuaCfgMgr.Get("MyWeaponType", weaponType)
    local x3Animator = CharacterMgr.AddX3AnimatorData(roleBaseGo, weaponData.Animator)
    x3Animator.AssetId = 1
    if x3Animator then
        x3Animator:Play(curWeaponSkinCfg.TeamShow, 0, CS.UnityEngine.Playables.DirectorWrapMode.None)
    end
end

return WeaponUtil