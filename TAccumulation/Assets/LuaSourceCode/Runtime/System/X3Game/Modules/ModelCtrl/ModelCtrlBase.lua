---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jianxin.
--- DateTime: 2023/2/17 18:07
---

local ModelCtrlBase = class("ModelCtrlBase", UICtrl)

function ModelCtrlBase:Init()
    ---@type string
    self.roleBaseKey = ""
    ---@type string[]
    self.rolePartKeys = {}
    ---@type fun<>
    self.onComplete = nil
    ---@type int
    self.retUuid = nil
    ---@type bool
    self.changeModel = true
    ---@type GameObject
    self.modelIns = nil
    ---@type Vector3
    self.rotationOffset = nil
end

function ModelCtrlBase:SetData(roleBaseKey, rolePartKeys, rotationOffset, onComplete)
    self.changeModel = self.roleBaseKey ~= roleBaseKey
    self.roleBaseKey = roleBaseKey
    self.rolePartKeys = rolePartKeys
end

function ModelCtrlBase:LoadModel()
    if self.retUuid ~= nil then
        return
    end
    if self.changeModel then
        if self.modelIns ~= nil then
            self:ReleaseModel()
        end
        self.retUuid = CharacterMgr.GetIns(self.roleBaseKey, self.rolePartKeys, self.filterPartTypes, function(ins, _)
            GameObjectUtil.SetActive(ins, true)
            self.modelIns = ins
            self.modelScript:AddTarget(self.modelIns, CharacterMgr.GetCharacterWave(), nil, self.rotationOffset)
        end, nil, nil, true)
    else
        CharacterMgr.RemoveAllParts(self.modelIns)
        CharacterMgr.ChangeParts(self.modelIns, self.rolePartKeys, self.filterPartTypes, function()
        end)
        self.modelScript:SetInitRot(self.rotationOffset, 0)
    end
end

---


return ModelCtrlBase