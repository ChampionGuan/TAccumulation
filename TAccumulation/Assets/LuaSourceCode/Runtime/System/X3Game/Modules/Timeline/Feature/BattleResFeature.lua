---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by changkong.
--- DateTime: 2021/8/14 14:48
---

-- 战斗资源加载特性：使用战斗接口通过Path加载timeline资源
local BaseFeature = require("Runtime.System.X3Game.Modules.Timeline.Feature.BaseFeature")
-- 已知对象池配套的onDiscard方法，此处已经通过别的方式清理过了，没有添加这个方法
---@class TimelineBattleResFeature:TimelineBaseFeature
local BattleResFeature = XECS.class("BattleResFeature", BaseFeature, true, 6)

function BattleResFeature:_OnBeforeBuild()
    local resPath = self.timeline:GetResPath()
    self.resObj = self.context:LoadTimelineObject(resPath)
    self.timeline:SetResObj(self.resObj)

    -- 添加到battle对象上
    local trans = g_BattleClient.go.transform
    if trans and self.resObj then
        self.resObj.transform.parent = trans
    end

    self.timeline:SetUseBattleResLoader(true)
    return true
end

function BattleResFeature:_OnDestroy()
    if self.resObj then
        self.context:UnloadGameObject(self.resObj)
        self.resObj = nil
    end
    self:discard()
end

return BattleResFeature