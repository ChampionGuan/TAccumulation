---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by changkong.
--- DateTime: 2021/8/14 14:48
---

-- 主线资源加载特性：①外部传入tiemlineObj就直接用，不加载 ②没有Obj使用主线资源加载接口加载obj
local BaseFeature = require("Runtime.System.X3Game.Modules.Timeline.Feature.BaseFeature")
-- 已知对象池配套的onDiscard方法，此处已经通过别的方式清理过了，没有添加这个方法
---@class TimelineMainlineResFeature:TimelineBaseFeature
local MainlineResFeature = XECS.class("MainlineResFeature", BaseFeature, true, 6)

function MainlineResFeature:_OnBeforeBuild()
    self.myLoadTimelineObj = false  -- timelineObj由我加载出来
    local timelineObj = self.timeline:GetResObj()
    -- 没有tiemlineObj就尝试使用路径加载
    if not timelineObj then
         local resPath = self.timeline:GetResPath()
        self.resObj = self.context:LoadTimelineObject(resPath)
        self.timeline:SetResObj(self.resObj)
        self.myLoadTimelineObj = true
    end
    return true
end

function MainlineResFeature:_OnDestroy()
    if self.myLoadTimelineObj and self.resObj then
        self.context:UnloadGameObject(self.resObj)
        self.resObj = nil
    end
    self.myLoadTimelineObj = false
    self.resObj = nil
    self:discard()
end

return MainlineResFeature