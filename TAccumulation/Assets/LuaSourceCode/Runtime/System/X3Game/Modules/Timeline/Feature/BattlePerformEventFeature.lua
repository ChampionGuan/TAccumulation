---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by changkong.
--- DateTime: 2021/8/19 14:16
---

local BattleEventFeature = require("Runtime.System.X3Game.Modules.Timeline.Feature.BattleEventFeature")
local EventLine = require("Runtime.Battle.Logic.Actor.EventLine.EventLine")
-- 战斗表演事件特性：从表演表中获取和战场男主相关的表演EventTimeline，把事件帧转发到BattleClient上
-- 已知对象池配套的onDiscard方法，此处已经通过别的方式清理过了，没有添加这个方法
---@class TimelineBattlePerformEventFeature:TimelineBattleEventFeature
local BattlePerformEventFeature = XECS.class("BattlePerformEventFeature", BattleEventFeature, true, 6)

function BattlePerformEventFeature:_OnBeforeBuild()
    local performConfig = self.timeline:GetPerformConfig()
    if performConfig and performConfig.Transition then
        local actor = g_BattleClient.battle:GetActor(BattleEntityID.Boy)
        if actor then
            local eventConfig = BattleUtil.GetEventLineConfig(actor.config, performConfig.Transition)
            if eventConfig then
                local eventLine = EventLine.new(performConfig.Transition, eventConfig)
                if eventLine then
                    self.timeline:SetBattleEventTimeline(eventLine)
                end
            end
        end
    end
    return true
end

function BattlePerformEventFeature:_OnFrameEvent(eventName, eventArgs)
    g_BattleClient.levelFSM:OnEvent(eventName, eventArgs, true)
end

return BattlePerformEventFeature