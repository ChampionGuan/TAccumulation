---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by junjun003.
--- DateTime: 2023/8/31 17:32
---

---@class DialogueChangeLightBindingAction : DialogueBaseAction
local DialogueChangeLightBindingAction = class("DialogueChangeLightBindingAction", require("Runtime.System.X3Game.Modules.Dialogue.Action.DialogueBaseAction"), nil ,true)

---ActionInit
---@param cfg DialogueActionCfg
function DialogueChangeLightBindingAction:OnInit(cfg)
    self.super.OnInit(self, cfg)
    ---@type DialogueEnum.ChangeLightBindingType 灯光方案行为Type
    self.actionType = cfg.actionType
    ---@type DynamicTarget 绑定目标
    self.target = cfg.target
    ---@type Vector3 本地坐标
    self.localPosition = cfg.localPosition
    ---@type Vector3 全局坐标
    self.localEulerAngles = cfg.localEulerAngles
end

---ActionEnter
function DialogueChangeLightBindingAction:OnEnter()
    local provider = CS.PapeGames.Rendering.CharacterLightingProvider.Current
    if provider then
        local trans = provider.transform
        if self.actionType == DialogueEnum.ChangeLightBindingType.Bind then
            local dynamicTarget = self.system:GetDynamicTarget(self.target)
            if dynamicTarget then
                self.system:AddRelativeCtrl(trans, dynamicTarget.transform)
            else
                GameObjectUtil.SetPosition(provider, self.localPosition)
                GameObjectUtil.SetEulerAngles(provider, self.localEulerAngles)
            end
        else
            self.system:RemoveRelativeCtrl()
        end
    end
end

return DialogueChangeLightBindingAction
