---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by junjun003.
--- DateTime: 2022/2/17 14:45
---

local NodeController = require("Runtime.System.X3Game.Modules.Dialogue.NodeController.NodeController")
---@class LoopCountController:NodeController
local LoopCountController = class("LoopCountController", NodeController, nil ,true)

---初始化数据
function LoopCountController:OnInit()
    self.super.OnInit(self)
    self.nodeControllerType = DialogueEnum.DialogueConditionType.LoopCount
end

---分析Link，判断节点结束后需要去哪个节点
function LoopCountController:AnalyzeLink()
    local loopedCount = self.pipeline:GetLoopedCount(self.dialogueEntry.uniqueID)
    if loopedCount < self.dialogueEntry.loopCount then
        self.pipeline:SetLoopedCount(self.dialogueEntry.uniqueID, loopedCount + 1)
        if self.dialogueEntry.outgoingLinks then
            self:AddWaitNode(self.dialogueEntry.outgoingLinks[1])
            self:ProcessSave(self.dialogueEntry.outgoingLinks[1])
        else
            self:ProcessSave()
        end
    else
        self.pipeline:SetLoopedCount(self.dialogueEntry.uniqueID, nil)
        if self.dialogueEntry.outgoingLinks then
            self:AddWaitNode(self.dialogueEntry.outgoingLinks[2])
            self:ProcessSave(self.dialogueEntry.outgoingLinks[2])
        else
            self:ProcessSave()
        end
    end
    self:ResumeUpdate()
end

return LoopCountController