---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by fusu.
--- DateTime: 2023/4/6 14:07
---

local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
local AccompanyBaseAction = require("Runtime.System.X3Game.Modules.Accompany.Action.AccompanyBaseAction")

---@class AccompanyStopAction : AccompanyBaseAction
local AccompanyStopAction = class("AccompanyStopAction" , AccompanyBaseAction)

function AccompanyStopAction:Init(actionParam)
    local dialogueKey = actionParam[1]
    self._dialogueName = self.accMgr.accBll:GetConfigDataByKey(dialogueKey)
    EventMgr.AddListener(AccompanyConst.Event.ON_ACCOMPANY_DIALOGUE_FINISH, self._OnAccompanyDialogueFinish, self)
    EventMgr.AddListener(AccompanyConst.Event.ON_STOP_ACCOMPANY_REPLY, self._OnStopAccompany, self)
end

---条件通过执行
function AccompanyStopAction:OnConditionPass()
end

function AccompanyStopAction:_OnAccompanyDialogueFinish(dialogueName)
    if self._dialogueName == dialogueName then
        local bll = BllMgr.GetAccompanyBLL()
        local curRoleId = bll:GetCurRoleId()
        local accompanyType = bll:GetCurAccompanyType()
        bll:Send_StopAccompanyRequest(curRoleId, accompanyType)
    end
end

function AccompanyStopAction:_OnStopAccompany()
    self:OnFinish()
end

return AccompanyStopAction