---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by fusu.
--- DateTime: 2023/4/6 14:07
---

local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
local AccompanyBaseAction = require("Runtime.System.X3Game.Modules.Accompany.Action.AccompanyBaseAction")

---@class AccompanyContinueAction : AccompanyBaseAction
local AccompanyContinueAction = class("AccompanyContinueAction" , AccompanyBaseAction)

function AccompanyContinueAction:Init(actionParam)
    EventMgr.AddListener(AccompanyConst.Event.ON_START_ACCOMPANY_REPLY, self._OnStartAccompany, self)
end

---条件通过执行
function AccompanyContinueAction:OnConditionPass()
    self:_SendStartAccompany()
end

---条件不同过执行
function AccompanyContinueAction:OnConditionNoPass()
    self:OnFinish()
    local stateCtrl = self.accMgr:GetCtrl(AccompanyConst.CtrlType.StateCtrl)
    stateCtrl:ChangeState(AccompanyConst.StateType.EndState)
end

---发送消息开始陪伴
function AccompanyContinueAction:_SendStartAccompany()
    local bll = BllMgr.GetAccompanyBLL()
    local curRoleId = bll:GetCurRoleId()
    local accompanyType = bll:GetCurAccompanyType()
    local curTime = bll:GetAccompanyTime()
    bll:Send_StartAccompanyRequest(curRoleId, accompanyType, curTime)
end

function AccompanyContinueAction:_OnStartAccompany()
    self:OnFinish()
    local stateCtrl = self.accMgr:GetCtrl(AccompanyConst.CtrlType.StateCtrl)
    stateCtrl:ChangeState(AccompanyConst.StateType.InteractState)
end

return AccompanyContinueAction