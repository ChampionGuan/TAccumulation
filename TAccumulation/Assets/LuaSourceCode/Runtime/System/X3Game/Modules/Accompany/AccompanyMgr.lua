---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by fusu.
--- DateTime: 2023/4/6 14:04
---
local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
---@class AccompanyMgr
local AccompanyMgr = class("AccompanyMgr")

function AccompanyMgr:ctor()
    ---@type AccompanyBLL
    self.accBll = BllMgr.GetAccompanyBLL()
    ---@type table<AccompanyConst.CtrlType,AccompanyBaseCtrl>
    self._ctrlMap = {}
end

function AccompanyMgr:OnDestroy()
    for _, ctrl in pairs(self._ctrlMap) do
        ctrl:OnDestroy()
    end
    self._ctrlMap = nil
    self._taskFinishList = nil
end

---初始化所有的Ctrl
---@param reconnect boolean
function AccompanyMgr:InitAllCtrl(reconnect)
    local allCtrlMap = AccompanyConst.CtrlType
    for _, ctrlType in pairs(allCtrlMap) do
        local curCtrl = self:GetCtrl(ctrlType)
        curCtrl:Init()
    end
    self:StartAccompany()
end

---根据类型获取Ctrl
---@return AccompanyBaseCtrl
function AccompanyMgr:GetCtrl(ctrlType)
    local ctrl = self._ctrlMap[ctrlType]
    if ctrl ~= nil then
        return ctrl
    end

    local ctrlPath = AccompanyConst.CtrlPath[ctrlType]
    if string.isnilorempty(ctrlPath) then
        Debug.LogErrorFormat("AccompanyConst.CtrlPath not has ctrlType: %s" , ctrlType)
        return nil
    end

    ctrl = require(ctrlPath).new(self, self.accBll)
    self._ctrlMap[ctrlType] = ctrl
    return ctrl
end

---开始陪伴
function AccompanyMgr:StartAccompany()
    local stateCrl = self:GetCtrl(AccompanyConst.CtrlType.StateCtrl)
    stateCrl:ChangeState(AccompanyConst.StateType.InitState)
end

return AccompanyMgr