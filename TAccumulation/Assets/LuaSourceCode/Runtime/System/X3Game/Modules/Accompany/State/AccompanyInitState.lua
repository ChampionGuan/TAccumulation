---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by fusu.
--- DateTime: 2023/4/4 17:40
---

local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
local AccompanyBaseState = require("Runtime.System.X3Game.Modules.Accompany.State.AccompanyBaseState")
---@class AccompanyInitState : AccompanyBaseState
local AccompanyInitState = class("AccompanyInitState", AccompanyBaseState)

---进入State
function AccompanyInitState:OnEnter()
    EventMgr.Dispatch(AccompanyConst.Event.ON_STATE_CHANGE , AccompanyConst.StateType.InitState)
    EventMgr.AddListener(AccompanyConst.Event.ON_START_ACCOMPANY_REPLY, self._OnStartAccompany, self)
    local isReconnect = BllMgr.GetAccompanyBLL():GetAccompanyReconnect()
    if isReconnect then
        local bll = BllMgr.GetAccompanyBLL()
        local curRoleId = bll:GetCurRoleId()
        local accompanyType = bll:GetCurAccompanyType()
        bll:Send_StartAccompanyRequest(curRoleId, accompanyType, 0)
    else
        self.stateCtrl:ChangeState(AccompanyConst.StateType.ModeSelect)
    end
end

---离开State
function AccompanyInitState:OnLeave()
    EventMgr.RemoveListener(AccompanyConst.Event.ON_START_ACCOMPANY_REPLY, self._OnStartAccompany, self)
end

function AccompanyInitState:_OnStartAccompany()
    self.stateCtrl:ChangeState(AccompanyConst.StateType.InteractState)
end

return AccompanyInitState