---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by fusu.
--- DateTime: 2023/4/19 14:54
---
local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
---@class AccompanyCondition
local AccompanyCondition = {}

--- 判断角色当前套装是否可以进入陪伴
local function AccompanySuitCheck(conditionParam)
    local curAccompanyType = BllMgr.GetAccompanyBLL():GetCurAccompanyType()
    if curAccompanyType and curAccompanyType == AccompanyConst.AccompanyType.Fitness then
        return false
    end
    
    local roleId = BllMgr.GetMainHomeBLL():GetData():GetRoleId()
    local curFashionList = BllMgr.GetFashionBLL():GetEveryDayFashionList(roleId)
    for _, fashionId in pairs(curFashionList) do
        local fashionConf = LuaCfgMgr.Get("FashionData" , fashionId)
        if fashionConf and fashionConf.AccompanyCheck == 1 then
            return false
        end
    end
    return true
end

--- 判断当前选择的陪伴是否设置时间
local function AccompanyTimeWndEnter(conditionParam)
    local accompanyTime = BllMgr.GetAccompanyBLL():GetAccompanyTime()
    return accompanyTime > 0
end

--- 判断当前是否继续陪伴
local function AccompanyIsNotContinue(conditionParam)
    return not BllMgr.GetAccompanyBLL():GetAccompanyContinue()
end

--- 判断当前是否继续陪伴
local function AccompanyIsContinue(conditionParam)
    return BllMgr.GetAccompanyBLL():GetAccompanyContinue()
end

AccompanyCondition.RegisterCondition =
{
    [AccompanyConst.ConditionType.AccompanyTimeWndEnter] = AccompanyTimeWndEnter,
    [AccompanyConst.ConditionType.AccompanySuitCheck] = AccompanySuitCheck,
    [AccompanyConst.ConditionType.AccompanyIsNotContinue] = AccompanyIsNotContinue,
    [AccompanyConst.ConditionType.AccompanyIsContinue] = AccompanyIsContinue,
}

--- 检查条件
function AccompanyCondition.CheckCondition(conditionType , conditionParam)
    local checkFunc = AccompanyCondition.RegisterCondition[conditionType]
    if checkFunc then
        return checkFunc(conditionParam)
    end
    return false
end

return AccompanyCondition