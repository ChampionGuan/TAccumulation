---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by sms.
--- DateTime: 2023/5/30 13:59

-- 当前Lua Script为支持登陆流程内的登陆背景生命周期管理创建

---@class LoginBgHelper
local LoginBgHelper = {}

-- 播放指定视频 打断当前背景展示
function LoginBgHelper.CheckPlayResUpdateVideo(videoResName)
    -- 这里的调用时机通常是在Lua虚拟机重启之前
    local isCsBgWndOpen = UIMgr.IsOpened(UIConf.LoginBgWnd)
    local isLuaUIView = UIMgr.GetViewByTag(UIConf.LoginBgWnd)
    if not isCsBgWndOpen or not isLuaUIView then Debug.LogError("LoginBgWnd not Open (CheckPlayResUpdateVideo)") end
    
    EventMgr.Dispatch("LOGIN_BG_PLAY_TARGET_VIDEO", videoResName)
end

-- 停止播放视频 恢复原来背景展示
function LoginBgHelper.CheckStopResUpdateVideo()
    local isCSViewOpened = UIMgr.IsOpened(UIConf.LoginBgWnd)
    local isLuaUIView = UIMgr.GetViewByTag(UIConf.LoginBgWnd)
    if not isCSViewOpened then Debug.LogError("LoginBgWnd not Open (CheckStopResUpdateVideo)") end
    if not isLuaUIView then
        -- 如果界面未打开或Lua虚拟机重启后Lua UIView对象未创建 则调用UIMgr.Open()方法 CS层UIMgr 会重新创建Lua UIView对象
        UIMgr.Open(UIConf.LoginBgWnd, {ignoreFirstOnShow = isCSViewOpened})
    else
        ---- 如果Lua和CS的对象都正常 直接抛出事件在Lua UIView层处理还原逻辑
        --EventMgr.Dispatch("LOGIN_BG_STOP_TARGET_VIDEO")
    end
end

-- 打开登陆背景界面
function LoginBgHelper.CheckOpenLoginBg(openLoginBgCb)
    local isLuaViewOpened = UIMgr.GetViewByTag(UIConf.LoginBgWnd)
    local isCSViewOpened = UIMgr.IsOpened(UIConf.LoginBgWnd)
    if not isLuaViewOpened then
        UIMgr.Open(UIConf.LoginBgWnd, {ignoreFirstOnShow = isCSViewOpened, firstVideoPlayedCallback = openLoginBgCb})
    else
        if openLoginBgCb then
            openLoginBgCb()
        end
    end
end

return LoginBgHelper