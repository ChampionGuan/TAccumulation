---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by xiaofang.
--- DateTime: 2022/3/24 18:09
local MainHomeConst = require("Runtime.System.X3Game.Modules.MainHome.Data.MainHomeConst")
---@type MainHome.BaseInteractAction
local BaseAction = require(MainHomeConst.BASE_INTERACT_ACTION)
---@class ChangeSceneAction:MainHome.BaseInteractAction
local ChangeSceneAction = class("ChangeSceneAction", BaseAction)

function ChangeSceneAction:Enter()
    BaseAction.Enter(self)
    EventMgr.AddListener(Const.Event.SCENE_OBJ_ACTIVE_CHANGED, self.SceneActiveChangeState, self)
    EventMgr.AddListener(MainHomeConst.Event.MAIN_HOME_CHANGE_SCENE_ACTION, self.ChangeSceneNtf, self)
end

function ChangeSceneAction:ChangeSceneNtf(param)
    self.actionParam = param
    self:Trigger()
end

function ChangeSceneAction:Begin()
    BaseAction.Begin(self)
    self:ChangeScene()
end

function ChangeSceneAction:ChangeScene()
    if self.actionParam then
        BllMgr.GetMainInteractBLL():DoChangeScene(self.actionParam.Resource, function()
            if self.actionParam and self.actionParam.CallBack then
                self.actionParam.CallBack()
            end
            self.actionParam = nil
            self:End()
        end)
    else
        self:End()
    end
end

function ChangeSceneAction:OnActorLoadSuccess()
    self:ChangeScene()
end

function ChangeSceneAction:End()
    BaseAction.End(self)
end

function ChangeSceneAction:SceneActiveChangeState(active)
    if not active then
        self:ChangeScene()
    end
end

return ChangeSceneAction