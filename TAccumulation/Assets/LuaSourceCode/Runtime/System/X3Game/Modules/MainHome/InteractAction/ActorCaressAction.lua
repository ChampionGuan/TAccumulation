---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/3/16 19:58
---抚摸男主的action
---@type MainHome.MainHomeConst
local MainHomeConst = require("Runtime.System.X3Game.Modules.MainHome.Data.MainHomeConst")
---@type MainHome.CountAction
local BaseAction = require("Runtime.System.X3Game.Modules.MainHome.InteractAction.CountAction")
---@class MainHome.ActorCaressAction:MainHome.CountAction
local ActorCaressAction = class("ActorCaressAction", BaseAction)


function ActorCaressAction:Begin()
    BaseAction.Begin(self)
    self:PlayDialogue()
end

function ActorCaressAction:Enter()
    BaseAction.Enter(self)
    local actionData = self:GetActionData()
    if actionData then
        self:SetMaxCount(actionData.Para3)
    end
end

---结束表演
function ActorCaressAction:End()
    ---统计计数
    if self.isRunning and self.endType == MainHomeConst.ActionClearType.Exit then
        local data = self.bll:GetData()
        local roleId = data:GetRoleId()
        ---249
        local actionCfg = self.bll:GetActionDataProxy():GetActionTypeCfg(self.actionType)
        if actionCfg.TaskCountID ~= 0 then
            local taskCountId = actionCfg.TaskCountID
            EventMgr.Dispatch(MainHomeConst.Event.MAIN_HOME_AI_SEND_REQUEST, MainHomeConst.NetworkType.ADD_ROLE_INTERACTIVE_BODY_TYPE_NUM, roleId, 1, self.partType , taskCountId)
        end
    end
    BaseAction.End(self)
end


---@param partType int
function ActorCaressAction:OnEventCaressActor(partType)
    local actionData = self:GetActionData()
    if actionData then
        self:SaveCount(partType)
        local count = self:GetCount(actionData.Para1,actionData.Para2)
        if count>= actionData.Para2 then
            self.partType = partType
            self:Trigger()
        end
    end
end

function ActorCaressAction:OnAddListener()
   EventMgr.AddListener(MainHomeConst.Event.MAIN_HOME_CARESS_ACTOR,self.OnEventCaressActor,self) 
end
return ActorCaressAction