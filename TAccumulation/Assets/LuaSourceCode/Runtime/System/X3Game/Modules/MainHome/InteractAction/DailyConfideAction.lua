---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by aoliao.
--- DateTime: 2023/2/20 15:41
---DailyConfideAction
---@type MainHome.MainHomeConst
local MainHomeConst = require("Runtime.System.X3Game.Modules.MainHome.Data.MainHomeConst")
---@type MainHome.BaseInteractAction
local BaseAction = require(MainHomeConst.BASE_INTERACT_ACTION)
---@class MainHome.DailyConfideAction:MainHome.BaseInteractAction
local DailyConfideAction = class("DailyConfideAction", BaseAction)


function DailyConfideAction:Enter()
    self.bll = BllMgr.GetMainHomeBLL()
    self.actionDataProxy = self.bll:GetActionDataProxy()
    BaseAction.Enter(self)
end

function DailyConfideAction:Exit()
    BaseAction.Exit(self)
end

function DailyConfideAction:Begin()
    BaseAction.Begin(self)
    ---@type cfg.MainUIAction
    local actionData = self:GetActionData()
    BllMgr.GetDailyConfideBll():StartDailyPhone(actionData)
end

function DailyConfideAction:End()

    BllMgr.GetDailyConfideBll():DisposeMgr()
    BaseAction.End(self)
end

function DailyConfideAction:IsCanTrigger()

    local cdTime = SelfProxyFactory.GetMainInteractProxy():GetInteractData():GetCDTimeByType(self:GetId())
    local curTime = TimerMgr.GetCurTimeSeconds()
    if cdTime > curTime then
        UICommonUtil.ShowMessage(UITextConst.UI_TEXT_11601)
        return false
    end
    return true
end
---触发类型
function DailyConfideAction:Trigger()
    if not self:IsCanTrigger() then
        return
    end
    if not self.actionDataProxy:IsActionUnlock(self:GetId(),true) then
        return
    end
    ---@type cfg.MainUIAction
    local actionData = self:GetActionData()
    BllMgr.GetDailyConfideBll():CheckDailyConfidePermissionReady(actionData.ActorID, function()
        self.bll:StartAction(self:GetId())
    end)
end

function DailyConfideAction:OnAddListener()
    EventMgr.AddListener(MainHomeConst.Event.MAIN_HOME_DAILY_CONFIDE_TRIGGER, self.OnDailyConfideTrigger, self)
end
function DailyConfideAction:OnDailyConfideTrigger()
    self:Trigger()
end
function DailyConfideAction:OnPause()
    BllMgr.GetDailyConfideBll():OnPause()
end
--继续
function DailyConfideAction:OnResume()
    BllMgr.GetDailyConfideBll():OnResume()
end

return DailyConfideAction