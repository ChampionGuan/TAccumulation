---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2022/4/8 12:19
---
---@type MainHome.MainHomeConst
local MainHomeConst = require("Runtime.System.X3Game.Modules.MainHome.Data.MainHomeConst")
---@type MainHome.BaseInteractAction
local BaseAction = require(MainHomeConst.BASE_INTERACT_ACTION)
---@class MainHome.EnterInteractDialogueAction:MainHome.BaseInteractAction
local EnterInteractDialogueAction = class("EnterInteractDialogueAction", BaseAction)

function EnterInteractDialogueAction:ctor()
    BaseAction.ctor(self)
    self.isCanTrigger = false
    self.isRefresh = false
end

function EnterInteractDialogueAction:Begin()
    BaseAction.Begin(self)
    self:PlayDialogue()
end

function EnterInteractDialogueAction:End()
    BaseAction.End(self)
end

function EnterInteractDialogueAction:OnModeChanged(mode,isStateChanged)
    if mode == MainHomeConst.ModeType.INTERACT then
        if self.bll:IsHandlerRunning(MainHomeConst.HandlerType.ActorMiddle) then
            self.isCanTrigger = true
            self.bll:StartActionByType(MainHomeConst.ActionType.MidPosEnter)
        end
    else
        self:Clear()
    end
end

function EnterInteractDialogueAction:Clear()
    self.isCanTrigger = false
    self.isRefresh = false
end

function EnterInteractDialogueAction:OnActorStateChanged()
    if self.isCanTrigger and self.isRefresh then
        self:Clear()
        self:Trigger()
    end
end

function EnterInteractDialogueAction:MainUISetActiveReply()
    if self.bll:GetMode() == MainHomeConst.ModeType.INTERACT then
        if self.isCanTrigger then
            self.isRefresh = true
        end
    end
end

function EnterInteractDialogueAction:OnAddListener()
    EventMgr.AddListener("MainUISetActiveReply",self.MainUISetActiveReply,self)
end

return EnterInteractDialogueAction