--- Generated by AutoGen
---
---@class MsgCmd_FriendInfoUpdateReply
local MsgCmd_FriendInfoUpdateReply = class("MsgCmd_FriendInfoUpdateReply", require("Runtime.System.Framework.GameBase.Misc.SimpleCommand"))

---Command执行
---@param reply pbcmessage.FriendInfoUpdateReply
function MsgCmd_FriendInfoUpdateReply:Execute(reply)
    ---Insert Your Code Here!
    if reply then
        ---@type FriendProxy
        local proxy = SelfProxyFactory.GetFriendProxy()
        local updateInfo = reply.UpdateInfo
        if updateInfo then
            local isUpdateFriending = false
            local isUpdateFriended = false
            local isUpdateFriendApply = false
            local isUpdateFriendGift = false

            ---1、先刷新赠送与领取数据
            if updateInfo.AddRecvStamina and updateInfo.AddRecvStamina ~= 0   then
                proxy:AddStaminaReceive(updateInfo.AddRecvStamina)
                proxy:RefreshFriendedItemByUid(updateInfo.AddRecvStamina)
                isUpdateFriended = true
                -- todo 好友赠礼
                isUpdateFriendGift = true
            end

            ---其他步骤已经刷新排序
            ---2、后刷新好友数据
            if updateInfo.AddFriend and updateInfo.AddFriend ~= 0  then
                proxy:AddFriended(updateInfo.AddFriend)
                proxy:RemoveFriendingByUid(updateInfo.AddFriend.Uid)
                proxy:RemoveMyApply(updateInfo.AddFriend.Uid)
                EventMgr.Dispatch("EVENT_REFRESH_FRIENDED_ADDFRIEND", true)
                isUpdateFriended = true
                isUpdateFriendApply = true

                proxy:RefreshMaxCount()
            end

            if updateInfo.AddAppliedFriend and updateInfo.AddAppliedFriend ~= 0 then
                proxy:AddFriending(updateInfo.AddAppliedFriend)
                isUpdateFriending = true
                isUpdateFriendApply = true
                isUpdateFriendGift = true
            end

            if updateInfo.RejectApply and updateInfo.RejectApply ~= 0 then
                ---他人拒绝，需要清理我的申请数据
                proxy:RemoveMyApply(updateInfo.RejectApply)
                isUpdateFriending = true
                isUpdateFriendApply = true
            end

            local isDelFriendFlag = false
            if updateInfo.DelFriend and updateInfo.DelFriend ~= 0 then
                ---没有删除之前可以表现一下？暂无
                proxy:RemoveFriendedByUid(updateInfo.DelFriend)
                ---好友删除，暂时刷新某些Button
                EventMgr.Dispatch("EVENT_REFRESH_DELFRIEND_SYNC")
                EventMgr.Dispatch("EVENT_REFRESH_FRIENDED_DELFRIEND", true)
                isUpdateFriended = true
                isDelFriendFlag = true
                isUpdateFriendApply = true
                isUpdateFriendGift = true
            end

            BllMgr.GetFriendBLL():CheckRed(isUpdateFriendApply, isUpdateFriendGift)

            if isUpdateFriended or isUpdateFriending then
                if isUpdateFriending then
                    ---更新申请列表
                    EventMgr.Dispatch("EVENT_REFRESH_FRIENDING_REFRESH")
                end
                if isUpdateFriended then
                    --Runtime.Common.RefreshRedPoint(Define.CornerMark.FriendedSystem)
                    ---0、更新好友列表 1、好友删除，立即删除数据，不会刷新View
                    if not isDelFriendFlag then
                        EventMgr.Dispatch("EVENT_REFRESH_FRIENDED_SCROLLVIEW")
                    end
                end
            end
        else
            Debug.Log("RecvMsg_FriendInfoUpdateReply error, serverdata.UpdateInfo = nil")
        end
    else
        Debug.Log("RecvMsg_FriendInfoUpdateReply error, serverdata = nil")
    end
end

return MsgCmd_FriendInfoUpdateReply
