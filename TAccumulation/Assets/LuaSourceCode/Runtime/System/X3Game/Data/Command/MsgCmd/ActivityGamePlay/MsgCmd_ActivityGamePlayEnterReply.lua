--- Generated by AutoGen
---
---@class MsgCmd_ActivityGamePlayEnterReply
local MsgCmd_ActivityGamePlayEnterReply = class("MsgCmd_ActivityGamePlayEnterReply", require("Runtime.System.Framework.GameBase.Misc.SimpleCommand"))

---Command执行
---@param reply pbcmessage.ActivityGamePlayEnterReply
function MsgCmd_ActivityGamePlayEnterReply:Execute(reply, request)
    ---收到进入游戏的消息
    --更新PlayCount
    local activityId = request.ActivityID
    BllMgr.GetActivityCenterBLL():UpdateActivityGamePlayCount(activityId, reply.PlayCount, nil, request.ManType)
    local ActivityCenterConst = require("Runtime.System.X3Game.GameConst.ActivityCenterConst")
    EventMgr.Dispatch(ActivityCenterConst.EventType.ACTIVITY_GAME_PLAY_UPDATE)

    --进入游戏
    --local gameType = request.GameType
    --local groupId = request.GameStageID

    local activityGroupConfig = LuaCfgMgr.Get("ActivityGameGroup", request.GameID)
    local roles = request.Params
    local difficultyId = BllMgr.GetGameplayBLL():GetDifficultyId(activityGroupConfig.GameType, activityGroupConfig.DifficultGroupID, roles[1])
    if difficultyId == 0 then
        Debug.LogErrorFormat("游戏配置获取错误,GameType:%s, GroupId: %s, roleId: %s", tostring(activityGroupConfig.GameType), tostring(activityGroupConfig.GroupID), tostring(roles[1]))
    else
        EventMgr.Dispatch("GamePlayCmd_EnterGame", Define.GamePlayEnterType.GamePlayEnterTypeActivity, activityGroupConfig.GameType, difficultyId, nil)
    end
end

return MsgCmd_ActivityGamePlayEnterReply
