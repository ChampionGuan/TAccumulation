--- Generated by AutoGen
---
---@class MsgCmd_ItemUpdateReply
local MsgCmd_ItemUpdateReply = class("MsgCmd_ItemUpdateReply", require("Runtime.System.Framework.GameBase.Misc.SimpleCommand"))

---Command执行
---@param data pbcmessage.ItemUpdateReply
function MsgCmd_ItemUpdateReply:Execute(data)
    Debug.Log("ItemUpdateReplyHandle");
    local bagRPRefresh = false
    for k, v in pairs(data.ItemList) do
        local curNum = BllMgr.GetItemBLL():GetItemNum(v.Id)
        local cfg = LuaCfgMgr.Get("Item", v.Id)
        if cfg then
            v.Type = cfg.Type
            BllMgr.GetItemBLL():AddItem(v)
            if BllMgr.GetItemBLL():IsPackageItem(v.Type) then
                if data.OpType == 1 and v.Num > curNum then
                    if BllMgr.GetItemBLL():CanOpenPackage(v.Id) then
                        if curNum == 0 then
                            bagRPRefresh = true ---只有新增才刷新红点[LYDJS-47740]
                        end

                        BllMgr.GetBagBLL():SetTopItem(true, v.Id)
                    else
                        BllMgr.GetBagBLL():SetDisablePackage(true, v.Id)
                    end
                elseif data.OpType ~= 1 or v.Num < curNum then
                    BllMgr.GetBagBLL():SetTopItem(false, v.Id)
                end
            end

            ---战斗装添加 刷新红点
            if v.Type == X3_CFG_CONST.ITEM_TYPE_FORMATIONSUIT and curNum < v.Num then
                BllMgr.GetFashionBLL():RefreshFormationSuitRp(v.Id)
                --R20.1 接入战斗套装获得tips，只显示非SCore送的默认作战装
                if not BllMgr.GetScoreBLL():Is_Default_SuitID(v.Id) then
                    ErrandMgr.Add(X3_CFG_CONST.POPUP_FORMATIONSUIT_GETREWARD, { ID = v.Id, Type = v.Type, Num = v.Num})
                end
            end
        end
    end

    if bagRPRefresh then
        BllMgr.GetBagBLL():SetBagRP(true)
        EventMgr.Dispatch("Refresh_BagEntranceRP");
    end
end

return MsgCmd_ItemUpdateReply
