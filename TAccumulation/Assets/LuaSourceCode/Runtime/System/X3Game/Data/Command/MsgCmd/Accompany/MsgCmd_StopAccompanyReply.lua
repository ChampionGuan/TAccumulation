--- Generated by AutoGen
---
local AccompanyConst = require("Runtime.System.X3Game.Modules.Accompany.Data.AccompanyConst")
---@class MsgCmd_StopAccompanyReply
local MsgCmd_StopAccompanyReply = class("MsgCmd_StopAccompanyReply", require("Runtime.System.Framework.GameBase.Misc.SimpleCommand"))

---Command执行
---@param reply pbcmessage.StopAccompanyReply
function MsgCmd_StopAccompanyReply:Execute(reply)
    ---Insert Your Code Here!
    Debug.LogFormat("MsgCmd_StopAccompanyReply Duration: %s" ,reply.Duration)

    local bll = BllMgr.GetAccompanyBLL()
    local roleId = bll:GetCurRoleId()
    local accompanyType = bll:GetCurAccompanyType()
    ---更新陪伴数据
    SelfProxyFactory.GetAccompanyProxy():AddOrUpdateRoleData(roleId ,
            {
                StartTime = 0,
                Duration = reply.Duration,
                OfflineDuration = 0,
                Type = accompanyType,
                ExpectDuration = 0,
                Records = {WeekRecordCnt = reply.WeekRecordCnt , YearRecords = reply.YearRecords}
            })
    ---更新陪伴记录
    SelfProxyFactory.GetAccompanyProxy():AddOrUpdateRoleRecord(roleId, reply.Duration)

    ---更新上次陪伴时间
    SelfProxyFactory.GetAccompanyProxy():AddOrUpdateRoleLastTimes(roleId, accompanyType, TimerMgr.GetCurTimeSeconds())
    
    EventMgr.Dispatch(AccompanyConst.Event.ON_STOP_ACCOMPANY_REPLY)
end

return MsgCmd_StopAccompanyReply
