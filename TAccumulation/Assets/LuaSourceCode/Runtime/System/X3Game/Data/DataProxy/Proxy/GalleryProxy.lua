---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by doudou.
--- DateTime: 2022/4/4 16:34
---@class GalleryProxy:BaseProxy
local GalleryProxy = class("GalleryProxy", BaseProxy)

function GalleryProxy:OnInit(owner)
    self.super.OnInit(self, owner)
    self.dollRwdMap = {}
    self.miaoGachaRwdMap = {}
    self.collectionMaxNum = {}
end
---@param collections pbcmessage.CollectionData
function GalleryProxy:InitCollectionMaxNum(collections)
    if not collections.RoleCollectionMap then
        return
    end

    for roleId, v in  pairs(collections.RoleCollectionMap) do
        local record = X3DataMgr.Get(X3DataConst.X3Data.GalleryRecord, roleId)
        if record then
            record:DecodeByField(v)
        else
            X3DataMgr.AddByPrimary(X3DataConst.X3Data.GalleryRecord, v, roleId)
        end
    end
end

function GalleryProxy:AddCollectionNum(roleId, id, num)
    ---@type X3Data.GalleryRecord
    local galleryRecord = X3DataMgr.Get(X3DataConst.X3Data.GalleryRecord, roleId)

    if galleryRecord == nil then
        galleryRecord = X3DataMgr.Add(X3DataConst.X3Data.GalleryRecord)
        galleryRecord:SetPrimaryValue(roleId)
    end

    local maxNumMap = galleryRecord:GetCollectionMaxNum()
    if maxNumMap and maxNumMap[id] then
        galleryRecord:AddOrUpdateCollectionMaxNumValue(id, maxNumMap[id] + num)
    else
        galleryRecord:AddOrUpdateCollectionMaxNumValue(id, num)
    end
end

function GalleryProxy:GetCollectionNum(roleId, id)
    local galleryRecord = X3DataMgr.Get(X3DataConst.X3Data.GalleryRecord, roleId)
    if galleryRecord then
        local maxNumMap = galleryRecord:GetCollectionMaxNum()
        return maxNumMap and maxNumMap[id] or 0
    end

    return 0
end

function GalleryProxy:AddDollRwd(roleId, num)
    if self.dollRwdMap[roleId] == nil then
        self.dollRwdMap[roleId] = {}
    end

    self.dollRwdMap[roleId][num] = true
end

function GalleryProxy:IsDollRewarded(roleId, num)
    if self.dollRwdMap[roleId] == nil then
        self.dollRwdMap[roleId] = {}
    end

    return self.dollRwdMap[roleId][num]
end

function GalleryProxy:AddMiaoGachaRwd(roleId, id)
    if self.miaoGachaRwdMap[roleId] == nil then
        self.miaoGachaRwdMap[roleId] = {}
    end

    self.miaoGachaRwdMap[roleId][id] = true
end


function GalleryProxy:IsMiaoGachaRewarded(roleId, id)
    if self.miaoGachaRwdMap[roleId] == nil then
        self.miaoGachaRwdMap[roleId] = {}
    end

    return self.miaoGachaRwdMap[roleId][id]
end

return GalleryProxy