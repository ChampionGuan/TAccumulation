---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by pc.
--- DateTime: 2020/10/19 19:29
---
RenderTextureUtil = {}
local RenderTexture = CS.UnityEngine.RenderTexture

local createRTMonitor;
local releaseRTMonitor;
---创建rt

--
--When 0 is used, then no Z buffer is created by a render texture.
--
--16 means at least 16 bit Z buffer and no stencil buffer. 24 or 32 means at least 24 bit Z buffer, and a stencil buffer.
--
--When requesting 24 bit Z Unity will prefer 32 bit floating point Z buffer if available on the platform.
---@param width number
---@param height number
---@param texture_format number default CS.UnityEngine.RenderTextureFormat.ARGB32
---@param depath number The precision of the render texture's depth buffer in bits (0, 16, 24/32 are supported).
---@return UnityEngine.RenderTexture
function RenderTextureUtil.GetRt(width, height, depath, texture_format)
    width = width and width or CS.UnityEngine.Screen.width
    height = height and height or CS.UnityEngine.Screen.height
    depath = depath and depath or 16
    texture_format = texture_format and texture_format or CS.UnityEngine.RenderTextureFormat.ARGB32
    local rt = RenderTexture.GetTemporary(math.floor(width), math.floor(height), depath, texture_format)

    if UNITY_EDITOR and createRTMonitor then
        createRTMonitor(rt, debug.traceback())
    end
    return rt
end

---通过RawImage, 创建RenderTexture
---@param rawImage UnityEngine.UI.RawImage
---@return UnityEngine.RenderTexture
function RenderTextureUtil.GetRtByRawImage(rawImage)
    if not rawImage then
        Debug.LogError("GetRtByRawImage: RawImage is nil.")
        return RenderTextureUtil.GetRt()
    end
    return RenderTextureUtil.GetRtByTransform(rawImage.rectTransform)
end

---通过RectTransform，创建RenderTexture
---@param rectTransform UnityEngine.Transform
---@return UnityEngine.RenderTexture
function RenderTextureUtil.GetRtByTransform(rectTransform)
    if not rectTransform then
        Debug.LogError("GetRtByTransform: rectTransform is nil.")
        return RenderTextureUtil.GetRt()
    end
    if not rectTransform.rect then
        Debug.LogError("GetRtByTransform: Transform.rect is nil.")
        return RenderTextureUtil.GetRt()
    end
    local width = math.floor(rectTransform.rect.width)
    local height = math.floor(rectTransform.rect.height)
    return RenderTextureUtil.GetRt(width, height)
end

---销毁rt
---@param rt UnityEngine.RenderTexture
function RenderTextureUtil.ReleaseRt(rt)
    if not rt then
        return
    end
    if UNITY_EDITOR and releaseRTMonitor then
        releaseRTMonitor(rt, debug.traceback())
    end

    RenderTexture.ReleaseTemporary(rt)
end

function RenderTextureUtil.SetMonitor(createFunc, releaseFunc)
    createRTMonitor = createFunc;
    releaseRTMonitor = releaseFunc;
end

return RenderTextureUtil