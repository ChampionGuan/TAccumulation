---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2021/12/21 15:21
--- 和业务逻辑无关的通用方法

---@class GameUtil
GameUtil = {}
local SpriteConf = require("Config.System.AutoGenerated.SpriteConf")

local vector3 = CS.UnityEngine.Vector3
local vector2 = CS.UnityEngine.Vector2
local quaternion = CS.UnityEngine.Quaternion

---清理绑定的相关信息数据
---@param target table
function GameUtil.ClearTarget(target)
    if not target then
        Debug.LogWarning("[GameUtil.ClearTarget] failed target is nil")
        return
    end
    EventMgr.RemoveListenerByTarget(target)
    GameObjectCtrl.RemoveCtrlByOwner(target)
    TimerMgr.DiscardTimerByTarget(target)
    X3DataMgr.UnsubscribeWithTarget(target)
    UIUtil.UIEventDelegateHelper.UnregisterByTarget(target)
    Framework.UnBindTarget(target)
    table.clear(target)
end

--region vector3相关
---获取vector
---@vararg string | Vector2 | Vector3
function GameUtil.GetVector(...)
    local param_count = select("#", ...)
    if param_count == 0 then
        return vector2.zero
    end
    local x, y, z = select(1, ...)
    if x==nil then return vector2.zero end
    if type(x) == "number" then
        return param_count <= 2 and vector2(x and x or 0, y and y or 0) or vector3(x, y, z)
    else
        return x
    end
end

---根据不定参数返回xyz
---说明：如果是xyz返回x,y,z，如果是x则返回x,x,x，如果是xy则返回x,y,0，如果是Vector3则返回Vector3.xyz，如果是Vector2则返回Vector2.xy0
---@vararg string | Vector2 | Vector3
---@return number,number,number
function GameUtil.GetVectorXYZ(...)
    local param_count = select("#", ...)
    if param_count == 0 then
        return 0, 0, 0
    end
    local x, y, z = select(1, ...)
    if x==nil then return 0,0,0 end
    if param_count == 1 then
        if type(x) == "number" then
            return x, x, x
        else
            return x.x or 0, x.y or 0, x.z or 0
        end
    else
        if type(x) == "number" then
            return x or 0, y or 0, z or 0
        else
            return x.x or 0, x.y or 0, x.z or 0
        end
    end
end

---@vararg number | Quaternion
---@return Quaternion
function GameUtil.GetQuaternion(...)
    local param_count = select("#", ...)
    if param_count == 0 then
        return quaternion(0, 0, 0, 0)
    end
    local x, y, z, w = select(1, ...)
    if x == nil then return quaternion(0,0,0,0) end
    if type(x) == "number" then
        return quaternion(x or 0, y or 0, z or 0, w or 0)
    else
        return x
    end
end

---获取坐标的xyzw
---@return number,number,number
function GameUtil.GetQuaternionXYZW(...)
    local param_count = select("#", ...)
    if param_count == 0 then
        return 0, 0, 0, 0
    end
    local x, y, z, w = select(1, ...)
    if x == nil then return 0,0,0,0 end
    if type(x) == "number" then
        return x or 0, y or 0, z or 0, w or 0
    else
        return x.x or 0, x.y or 0, x.z or 0, x.w or 0
    end
end

---解析图集文件路径
---@param sprite_name string
---@return string,string,boolean  路径/名称，atlas的名称，是否是全路径模式
function GameUtil.GetSpriteAndAtlasNames(sprite_name)
    local atlas_name = SpriteConf.GetAtlasName(sprite_name)
    local is_path = false
    if atlas_name == nil then
        sprite_name, is_path = SpriteConf.GetDynamicSpritePath(sprite_name)
    end
    return sprite_name, atlas_name, is_path
end

---@param spName string
---@return boolean
function GameUtil.IsSpriteLocale(spName)
    return SpriteConf.IsLocale(spName)
end

---tabMenu setValue or getValue OnValueChange 使用 用于把选中的状态转换为标记量
---@param idx int
---@param childIdx int
---@return int
function GameUtil.GetTabMenuSelectSign(idx, childIdx)
    return idx << 16 | childIdx
end

---标记量翻转为 idx
---@param sign int
---@return int,int
function GameUtil.GetTabMenuSelectIdx(sign)
    local idx = sign >> 16
    local childIdx = sign - (idx << 16)
    return idx, childIdx
end

return GameUtil