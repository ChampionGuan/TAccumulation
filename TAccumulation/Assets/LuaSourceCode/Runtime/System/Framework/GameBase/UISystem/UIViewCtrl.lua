---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2021/12/21 19:37
--- 所有ui的基类

---@class UIViewCtrl:UICtrl
UIViewCtrl = class("UIViewCtrl", UICtrl)

---@type table<int,any>
local UI_CACHE_DATA = {}

--region 初始化
function UIViewCtrl:ctor()
    UICtrl.ctor(self)
    ---@type PapeGames.X3UI.UIView
    self.cs = nil
    ---@type int
    self.cs_ins_id = 0
    ---@type string
    self.view_tag = ''
end
--endregion

--region 本地数据缓存
---缓存数据
---@param key any 任意类型
---@param value any 任意类型
function UIViewCtrl:Cache(key, value)
    if not key then
        Debug.LogError(self.__cname, "[Cache]--failed", key, value)
        return
    end
    local cache = UI_CACHE_DATA[self:GetInsId()]
    if not cache then
        cache = PoolUtil.GetTable()
        UI_CACHE_DATA[self:GetInsId()] = cache
    end
    cache[key] = value
    return true
end

---获取缓存数据
---@param key any
---@param default_value any
---@return any
function UIViewCtrl:GetCache(key, default_value)
    if not key then
        return default_value
    end
    local cache = UI_CACHE_DATA[self:GetInsId()]
    if not cache then
        return default_value
    end
    return cache[key]
end
--endregion

--region ui绑定相关属性
---设置绑定的CS
---@param cs UnityEngine.Object
---@param id int GameObject的唯一id
---@param view_tag string 名称
function UIViewCtrl:SetCs(cs, id, view_tag)
    self.cs = cs
    self.cs_ins_id = id
    self.view_tag = view_tag
end

---获取CS
---@return UnityEngine.Object
function UIViewCtrl:GetCs()
    return self.cs
end

---获取
---@return int
function UIViewCtrl:GetInsId()
    return self.cs_ins_id
end

---@return string
function UIViewCtrl:GetViewTag()
    return self.view_tag
end
--endregion

--region UIView操作方法
-- 刷新UIView的所有Canvas和粒子的排序
function UIViewCtrl:RefreshSortingOrder()
    UIMgr.RefreshSortingOrder(self.cs_ins_id)
end

--- 设置自动关闭模式
---@param mode AutoCloseMode
function UIViewCtrl:SetAutoCloseMode(mode)
    UIMgr.SetAutoCloseMode(self.view_tag, mode)
end

---关闭UI
---@param withAnim boolean
function UIViewCtrl:Close(withAnim)
    UIMgr.Close(self:GetInsId(), withAnim)
end

---显示界面
function UIViewCtrl:Show()
    UIMgr.Show(self:GetViewTag())
end

---隐藏界面
function UIViewCtrl:Hide()
    UIMgr.Hide(self:GetViewTag())
end

--endregion

--region 周期函数
---被弹出
function UIViewCtrl:OnPopTop()
end

---弹入
function UIViewCtrl:OnPushBack()
end

---focus
function UIViewCtrl:OnFocus(...)
end

---blur
function UIViewCtrl:OnBlur(...)
end

---movein 结束
function UIViewCtrl:OnMoveInComplete(...)
end

---moveout结束
function UIViewCtrl:OnMoveOutComplete(...)
end

---movein 开始
function UIViewCtrl:OnMoveInStart(...)
end

---moveout 开始
function UIViewCtrl:OnMoveOutStart(...)
end

---销毁
function UIViewCtrl:OnDestroy()
    
end
--endregion

function UIViewCtrl:Destroy()
    local ins = self:GetInsId()
    if ins then
        local cache = UI_CACHE_DATA[ins]
        if cache then
            PoolUtil.ReleaseTable(cache)
            UI_CACHE_DATA[ins] = nil
        end

    end
    UICtrl.Destroy(self)
end


