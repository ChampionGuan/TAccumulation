---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jiaozhu.
--- DateTime: 2023/8/10 11:00
---
---@class FSM.FSMHelper
local FSMHelper = {}

---@type table<int,Pool>
local componentPool = {}

--region 底层调用
---@class FSM.UseArgName1
---@param componentType FSM.FSMComponent
---@return FSM.UseArgName1
function FSMHelper.CreateComponent(componentType)
    if not componentType then
        Debug.LogError("[FSMHelper.CreateComponent] failed componentType is nil")
        return
    end
    local pool = componentPool[componentType]
    if not pool then
        local path = FSMConst.ComponentConf[componentType]
        pool = PoolUtil.Get(function(...)
            local c = require(path).new()
            c.__is_new__ = true
            return c
        end, function(comp)
            comp:Destroy()
        end)
        componentPool[componentType] = pool
    end
    ---@type FSM.FSMBase
    local comp = pool:Get()
    if not comp.__is_new__ then
        comp:ctor()
    end
    comp:SetComponentType(componentType)
    return comp
end

---@param component FSM.FSMBase
function FSMHelper.ReleaseComponent(component)
    if not component then
        return
    end
    local pool = componentPool[component:GetComponentType()]
    if pool then
        pool:Release(component)
    end
end

---@param name string
---@param varType FSM.FSMVarType
---@param value FSMVarValueType
---@param shareType FSM.FSMVarShareType
---@param subVarType FSM.FSMVarType
---@param readonly boolean
---@param fsm FSM.FSM
---@param context FSM.FSMContext
---@return FSM.FSMVar | FSM.FSMVarArray
function FSMHelper.CreateVar(name, value, varType, shareType, subVarType,readonly, fsm,context)
    shareType = shareType or FSMConst.FSMVarShareType.Normal
    ---@type FSM.FSMVar
    local var = FSMHelper.CreateComponent(varType == FSMConst.FSMVarType.Array and FSMConst.FSMComponent.FSMVarArray or FSMConst.FSMComponent.FSMVar)
    var:SetBasic(name, fsm, nil, fsm and fsm.context or context)
    var:Parse(name, value, varType, shareType, subVarType,readonly)
    return var
end

---@param var FSM.FSMBase
function FSMHelper.ReleaseVar(var)
    FSMHelper.ReleaseComponent(var)
end

function FSMHelper.Clear()
    table.clear(componentPool)
end

return FSMHelper